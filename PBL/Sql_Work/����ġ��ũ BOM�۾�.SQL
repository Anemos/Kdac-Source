-- 제품, BOM하위자재, 입고량, 소요량
SELECT AA.ZMDNO AS ZMDNO, AA.ZITNO AS ZITNO, BB.SEL0004 AS MDQTY, BB.SEL0004 * AA.ZUNITQTY AS NORMALQTY
FROM PBPDM.BOM013 AA INNER JOIN PBPDM.BOM013SQL BB
	ON AA.ZPLANT = BB.XPLANT AND AA.ZDIV = BB.DIV AND AA.ZMDNO = BB.ITNO AND BB.SEL0004 <> 0
WHERE AA.ZCMCD = '01' AND AA.ZDATE = '200712' AND AA.ZPLANT = 'D' AND AA.ZDIV = 'M';

SELECT CC.WBITNO AS ITNO, SUM(DECIMAL((CC.WBUSQT1 / IFNULL(DD.CONVQTY,1)),15,4)) AS USQT
FROM PBWIP.WIP002 CC LEFT OUTER JOIN PBINV.INV101 DD
  ON CC.WBCMCD = DD.COMLTD AND CC.WBPLANT = DD.XPLANT AND CC.WBDVSN = DD.DIV AND
    CC.WBITNO = DD.ITNO
WHERE CC.WBCMCD = '01' AND CC.WBPLANT = 'D' AND CC.WBDVSN = 'M' AND
  CC.WBYEAR = '2007' AND CC.WBIOCD = '1'
GROUP BY CC.WBITNO;


SELECT EE.ITNO AS ITNO, SUM(EE.INTQTY) AS INTQTY FROM PBINV.INV402 EE
WHERE EE.COMLTD = '01' AND EE.XPLANT = 'D' AND EE.DIV = 'M' AND
EE.XYEAR >= '200701' AND EE.XYEAR <= '200712' AND EE.ITCL IN ('10','30','40','50')
GROUP BY EE.ITNO;


SELECT TMP_1.ZITNO, TMP_1.PDCD, TMP_1.ZDESC, TMP_1.CHKITN, TMP_1.COSTVALUE, TMP_1.NORMALQTY, TMP_3.INTQTY, TMP_2.USQT1, TMP_2.USQT2
FROM 
( SELECT AA.ZITNO AS ZITNO, AA.ZMDCD AS PDCD, AA.ZDESC AS ZDESC, IFNULL(FF.TCITN,'') AS CHKITN, GG.COSTLS AS COSTVALUE, SUM(BB.SEL0004 * AA.ZUNITQTY) AS NORMALQTY
FROM PBPDM.BOM013 AA INNER JOIN PBPDM.BOM013SQL BB
	ON AA.ZPLANT = BB.XPLANT AND AA.ZDIV = BB.DIV AND AA.ZMDNO = BB.ITNO AND BB.SEL0004 <> 0
  LEFT OUTER JOIN PBWIP.WIP015 FF
	ON FF.TCMCD = AA.ZCMCD AND FF.TPLNT = AA.ZPLANT AND FF.TDVSN = AA.ZDIV AND
		FF.TCITN = AA.ZITNO AND FF.TLEVEL = 0
	LEFT OUTER JOIN PBINV.INV101 GG
	ON AA.ZCMCD = GG.COMLTD AND AA.ZPLANT = GG.XPLANT AND AA.ZDIV = GG.DIV AND AA.ZITNO = GG.ITNO
WHERE AA.ZCMCD = '01' AND AA.ZDATE = '200712' AND AA.ZPLANT = 'D' AND AA.ZDIV = 'M'
GROUP BY AA.ZITNO, AA.ZMDCD, AA.ZDESC, FF.TCITN, GG.COSTLS ) TMP_1
LEFT OUTER JOIN 
( SELECT CC.WBITNO AS ITNO, SUM(DECIMAL((CC.WBUSQT1 / IFNULL(DD.CONVQTY,1)),15,4)) AS USQT1, SUM(DECIMAL((CC.WBUSQT2 / IFNULL(DD.CONVQTY,1)),15,4)) AS USQT2
FROM PBWIP.WIP002 CC LEFT OUTER JOIN PBINV.INV101 DD
  ON CC.WBCMCD = DD.COMLTD AND CC.WBPLANT = DD.XPLANT AND CC.WBDVSN = DD.DIV AND
    CC.WBITNO = DD.ITNO
WHERE CC.WBCMCD = '01' AND CC.WBPLANT = 'D' AND CC.WBDVSN = 'M' AND
  CC.WBYEAR = '2007' AND CC.WBMONTH >= '01' AND CC.WBMONTH <= '12' AND CC.WBIOCD <> '3'
GROUP BY CC.WBITNO ) TMP_2
ON TMP_1.ZITNO = TMP_2.ITNO
LEFT OUTER JOIN 
( SELECT EE.ITNO AS ITNO, SUM(EE.INTQTY) AS INTQTY FROM PBINV.INV402 EE
WHERE EE.COMLTD = '01' AND EE.XPLANT = 'D' AND EE.DIV = 'M' AND
EE.XYEAR >= '200701' AND EE.XYEAR <= '200712' AND EE.CLS IN ('10','30','40','50')
GROUP BY EE.ITNO ) TMP_3
ON TMP_1.ZITNO = TMP_3.ITNO;


INSERT INTO PBPDM.BOM013SQL( XPLANT, DIV, ITNO, SEL0004 )
SELECT XPLANT,DIV,ITNO, SUM(INTQTY) FROM PBINV.INV402
WHERE COMLTD = '01' AND XPLANT = 'D' AND DIV = 'M' AND XYEAR >= '200701' AND XYEAR <= '200706' AND
	ITNO IN (
SELECT DISTINCT BB.ZMDNO FROM PBWIP.WIP015 AA INNER JOIN PBPDM.BOM013 BB
	ON AA.TCMCD = BB.ZCMCD AND AA.TPLNT = BB.ZPLANT AND AA.TDVSN = BB.ZDIV AND
	AA.TCITN = BB.ZITNO
	INNER JOIN PBINV.INV101 CC
	ON BB.ZCMCD = CC.COMLTD AND BB.ZPLANT = CC.XPLANT AND BB.ZDIV = CC.DIV AND
		BB.ZMDNO = CC.ITNO AND CC.CLS = '30'
WHERE AA.TLEVEL = 0 AND BB.ZCMCD = '01' AND BB.ZDATE = '200706' AND BB.ZPLANT = 'D' AND
BB.ZDIV = 'M')
GROUP BY XPLANT,DIV,ITNO;


SELECT WDSLTY,WDSRNO,WDITNO,WDCHQT,WDDATE,WEREMK FROM PBWIP.WIP004 INNER JOIN PBWIP.WIP005
ON WDCMCD = WECMCD AND WDSLTY = WESLTY AND WDSRNO = WESRNO
INNER JOIN PBWIP.WIP015
ON WDCMCD = TCMCD AND WDPLANT = TPLNT AND WDDVSN = TDVSN AND
	WDITNO = TCITN AND TLEVEL = 0
WHERE WDCMCD = '01' AND WDSLTY = 'WX' AND WDPLANT = 'D' AND WDDVSN = 'M' AND
WDDATE >= '20070101' AND WDDATE <= '20071231'