SELECT PBCOMMON.F_CODENM(AA.WBCMCD,'SLE220',AA.WBPLANT,'1') as plantnm,
      PBCOMMON.F_CODENM(AA.WBCMCD,'DAC030',AA.WBDVSN,'1') as dvsnnm,
      PBCOMMON.F_CODENM(AA.WBCMCD,'DAC160',AA.WBPDCD,'1') as pdcdnm,
      AA.WBITCL, AA.WBSRCE, AA.WFDEPT, BB.XUNIT, CC.ITNM, AA.WBPLANT,
      AA.WBDVSN, AA.WBITNO, AA.WBPDCD, BB.CONVQTY, AA.WBSCRP AS SCRP,
      AA.WBRETN AS RETN,
      DECIMAL(AA.WBAVRG1 * BB.CONVQTY,15,5) AS AVRG1,
      DECIMAL(AA.WBBGQT  / BB.CONVQTY,15,4) AS BGQT,
      AA.WBBGAT1 AS BGAT,
      DECIMAL(AA.WBINQT  / BB.CONVQTY,15,4) AS INQT,
      (AA.WBINAT1 + AA.WBINAT2 + AA.WBINAT3 ) AS INAT,
      DECIMAL(AA.WBUSQT1 / BB.CONVQTY,15,4) AS USQT1,
      AA.WBUSAT1 AS USAT1,
      DECIMAL(AA.WBUSQT2 / BB.CONVQTY,15,4) AS USQT2,
      AA.WBUSAT2 AS USAT2,
      DECIMAL(AA.WBUSQT3 / BB.CONVQTY,15,4) AS USQT3,
      AA.WBUSAT3 AS USAT3,
      DECIMAL(AA.WBUSQT4 / BB.CONVQTY,15,4) AS USQT4,
      AA.WBUSAT4 AS USAT4,
      DECIMAL(AA.WBUSQT5 / BB.CONVQTY,15,4) AS USQT5,
      AA.WBUSAT5 AS USAT5,
      DECIMAL(AA.WBUSQT6 / BB.CONVQTY,15,4) AS USQT6,
      AA.WBUSAT6 AS USAT6,
      DECIMAL(AA.WBUSQT7 / BB.CONVQTY,15,4) AS USQT7,
      AA.WBUSAT7 AS USAT7,
      DECIMAL(AA.WBUSQT8 / BB.CONVQTY,15,4) AS USQT8,
      AA.WBUSAT8 AS USAT8,
      AA.WBUSAT9 AS USAT9,
      DECIMAL(( AA.WBBGQT + AA.WBINQT - ( AA.WBUSQT1 + AA.WBUSQT2 + AA.WBUSQT3 +
        AA.WBUSQT4 + AA.WBUSQT5 + AA.WBUSQT6 + AA.WBUSQT7 + AA.WBUSQT8 )
        - AA.WFPHQT) / BB.CONVQTY,15,4) AS DIFFQTA,
      DECIMAL(( AA.WBBGQT + AA.WBINQT - ( AA.WBUSQT1 + AA.WBUSQT2 + AA.WBUSQT3 +
        AA.WBUSQT4 + AA.WBUSQT5 + AA.WBUSQT6 + AA.WBUSQT7 + AA.WBUSQT8 )
        - AA.WFPHQT) * AA.WBAVRG1, 15,0) AS DIFFATA,
      DECIMAL(( AA.WBBGQT + AA.WBINQT - ( AA.WBUSQT1 + AA.WBUSQT2 + AA.WBUSQT3 +
        AA.WBUSQT4 + AA.WBUSQT5 + AA.WBUSQT6 + AA.WBUSQT7 + AA.WBUSQT8 )
        ) / BB.CONVQTY,15,4) AS CUR_QTY,
      ( AA.WBBGAT1 + AA.WBINAT1 + AA.WBINAT2 + AA.WBINAT3 - ( AA.WBUSAT1 +
        AA.WBUSAT2 + AA.WBUSAT3 + AA.WBUSAT4 + AA.WBUSAT5 + AA.WBUSAT6 +
        AA.WBUSAT7 + AA.WBUSAT8 + AA.WBUSAT9 )) AS CUR_AMT,
      DECIMAL( AA.WFPHQT / BB.CONVQTY, 15, 4) AS BET_QTY,
      DECIMAL( AA.WFPHQT * AA.WBAVRG1 ) AS BET_AMT,
      DECIMAL(( AA.WBUSQT1 + AA.WBUSQT2 + AA.WBUSQT3 + AA.WBUSQT4 + AA.WBUSQT5 +
        AA.WBUSQT6 + AA.WBUSQT7 + AA.WBUSQT8 ) / BB.CONVQTY,15,4) AS USE_QTY,
      ( AA.WBUSAT1 + AA.WBUSAT2 + AA.WBUSAT3 + AA.WBUSAT4 + AA.WBUSAT5 +
        AA.WBUSAT6 + AA.WBUSAT7 + AA.WBUSAT8 + AA.WBUSAT9 ) AS USE_AMT
FROM
( SELECT WBCMCD,WBPLANT,WBDVSN,WBITNO,WFDEPT,WBPDCD,WBITCL,WBSRCE,WBSCRP,WBRETN,
  		WBAVRG1,WBBGQT,WBBGAT1,WBINQT,WBINAT1,WBINAT2,WBINAT3,
  		WBUSQT1,WBUSAT1,WBUSQT2,WBUSAT2,WBUSQT3,WBUSAT3,WBUSQT4,WBUSAT4,
  		WBUSQT5,WBUSAT5,WBUSQT6,WBUSAT6,WBUSQT7,WBUSAT7,WBUSQT8,WBUSAT8,
  		WBUSAT9,WFPHQT
	FROM PBWIP.WIP002, PBWIP.WIP006
	WHERE WBCMCD = WFCMCD   AND WBPLANT = WFPLANT AND
      	WBDVSN = WFDVSN   AND WBYEAR = WFYEAR AND
      	WBMONTH = WFMONTH AND WBITNO = WFITNO AND
      	WBCMCD = :a_cmcd  AND WBYEAR = :a_yyyy AND
      	WBMONTH = :a_mm   AND WBPLANT = :a_plant AND
      	WBDVSN = :a_dvsn  AND WBORCT = '9999' AND
      	WBPDCD LIKE :a_pdcd AND
      	NOT ( WBBGQT = 0 AND WBINQT = 0 AND WBUSQT1 = 0 AND WBUSQT2 = 0 AND
            WBUSQT3 = 0 AND WBUSQT4 = 0 AND WBUSQT5 = 0 AND WBUSQT6 = 0 AND
            WBUSQT7 = 0 AND WBUSQT8 = 0 AND WBUSQTA = 0 AND WFPHQT = 0 ) ) AA,
	PBINV.INV101 BB, PBINV.INV002 CC
WHERE BB.COMLTD = CC.COMLTD AND BB.ITNO = CC.ITNO AND
      AA.WBCMCD = BB.COMLTD AND AA.WBPLANT = BB.XPLANT AND
      AA.WBDVSN = BB.DIV    AND AA.WBITNO  = BB.ITNO
ORDER BY AA.WBPDCD, AA.WFDEPT,AA.WBITNO
