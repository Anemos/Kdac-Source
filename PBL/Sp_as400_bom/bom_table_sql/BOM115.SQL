--  Generate SQL
--  Version:                    V5R3M0 040528
--  Generated on:               09/06/22 12:01:56
--  Relational Database:        I520
--  Standards Option:           DB2 UDB iSeries
--  Description :               전공장기준 원단위DB For 조회

CREATE TABLE PBPDM.BOM115 (
  ZCMCD CHAR(2) CCSID 833 NOT NULL DEFAULT '' ,       -- 회사
  ZDATE CHAR(6) CCSID 833 NOT NULL DEFAULT '' ,       -- 년월
  ZPLANT CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,      -- 지역
  ZDIV CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,        -- 공장
  ZMDCD VARCHAR(4) CCSID 833 NOT NULL DEFAULT '' ,    -- 제품군
  ZMDNO VARCHAR(12) CCSID 833 NOT NULL DEFAULT '' ,      -- 완제품
  ZSERIAL NUMERIC(4,0) NOT NULL DEFAULT 0 ,          -- SERIAL NO
  ZLEVEL VARCHAR(10) CCSID 833 NOT NULL DEFAULT '' ,  -- BOM LEVEL
  ZPITNO VARCHAR(12) CCSID 833 NOT NULL DEFAULT '' ,  -- 상위품번
  ZITNO VARCHAR(12) CCSID 833 NOT NULL DEFAULT '' ,      -- 품번
  ZREV CHAR(2) CCSID 833 NOT NULL DEFAULT '' ,        -- REV NO
  ZDESC VARCHAR(50) CCSID 933 NOT NULL DEFAULT '' ,      -- 품명
  ZSPEC VARCHAR(50) CCSID 933 NOT NULL DEFAULT '' ,      -- 규격
  ZUNIT1 CHAR(2) CCSID 833 NOT NULL DEFAULT '' ,      -- BOM단위
  ZUNITQTY DECIMAL(8,3) NOT NULL DEFAULT 0.000 ,   -- 원단위량
  ZCVTFACT DECIMAL(13,4) NOT NULL DEFAULT 0.0000 ,   -- 변환계수
  ZUNIT2 CHAR(2) CCSID 833 NOT NULL DEFAULT '' ,      -- 자재단위
  ZSRCE CHAR(2) CCSID 833 NOT NULL DEFAULT '' ,       -- 구입선
  ZABCCODE CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,    -- ABC CODE
  ZISSCODE CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,    -- 불출코드
  ZWHLCODE VARCHAR(6) CCSID 833 NOT NULL DEFAULT '' ,  -- 창고코드
  ZLOTSIZE DECIMAL(11,1) NOT NULL DEFAULT 0.0 ,        -- LOT SIZE
  ZLEADTIME DECIMAL(3,0) NOT NULL DEFAULT 0 ,          -- LEAD TIME
  ZMOVCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 이동평균단가
  ZRCPCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 최종입고단가
  ZOUTCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 불출평균단가
  ZWKCT CHAR(4) CCSID 833 NOT NULL DEFAULT '' ,       -- 조코드
  ZGRAD CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,       -- 호환여부
  ZALTNO VARCHAR(12) CCSID 833 NOT NULL DEFAULT '' ,     -- 호환품번
  ZFMDT CHAR(8) CCSID 833 NOT NULL DEFAULT '' ,       -- 적용시작일
  ZTODT CHAR(8) CCSID 833 NOT NULL DEFAULT '' ,       -- 적용완료일
  ZCALC CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,       -- 재료비 계산여부
  ZEXPLANT CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,    -- 이체지역
  ZEXDIV CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,      -- 이체공장
  ZCOMCD CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,      -- 고객사유상 대상여부
  ZYGCHK CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,      -- 사급완성품여부
  ZYGCST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,    -- 가공관리비
  ZSCMOVCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 이동평균단가(가공관리비)
  ZSCRCPCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 최종입고단가(가공관리비)
  ZSCOUTCOST DECIMAL(15,6) NOT NULL DEFAULT 0.000000 ,   -- 불출평균단가(가공관리비)
  ZCALC2 CHAR(1) CCSID 833 NOT NULL DEFAULT '' ,       -- 재료비 계산여부
  PRIMARY KEY( ZCMCD , ZDATE , ZPLANT , ZDIV , ZMDCD , ZMDNO , ZSERIAL ) ) ;

CREATE INDEX PBPDM.BOM115LX01
  ON PBPDM.BOM115 ( ZCMCD ASC , ZDATE DESC , ZITNO ASC , ZEXPLANT ASC , ZEXDIV ASC ) ;

CREATE INDEX PBPDM.BOM115LX02
  ON PBPDM.BOM115 ( ZCMCD ASC , ZDATE DESC , ZPLANT ASC , ZDIV ASC, ZMDNO ASC, ZITNO ASC ) ;


---- 생성로직
INSERT INTO PBPDM.BOM115
( ZCMCD,ZDATE,ZPLANT,ZDIV,ZMDCD,ZMDNO,ZSERIAL,ZLEVEL,ZPITNO,ZITNO,ZREV,ZDESC,ZSPEC,
ZUNIT1,ZUNITQTY,ZCVTFACT,ZUNIT2,ZSRCE,ZABCCODE,ZISSCODE,ZWHLCODE,ZLOTSIZE,ZLEADTIME,ZMOVCOST,ZRCPCOST,ZOUTCOST,
ZWKCT,ZGRAD,ZALTNO,ZFMDT,ZTODT,ZCALC,ZEXPLANT,ZEXDIV,ZCOMCD,ZYGCHK,ZYGCST )

SELECT ZCMCD,ZDATE,ZPLANT,ZDIV,ZMDCD,ZMDNO,ZSERIAL,ZLEVEL,'',ZITNO,ZREV,ZDESC,ZSPEC,
ZUNIT1,
DECIMAL( CASE WHEN REPLACE(ZUNITQTY,',','') = '' THEN 0
	ELSE REPLACE(ZUNITQTY,',','') END,8,3),
DECIMAL( CASE WHEN REPLACE(ZCVTFACT,',','') = '' THEN 0
	ELSE REPLACE(ZCVTFACT,',','') END,13,4),ZUNIT2,ZSRCE,ZABCCODE,ZISSCODE,ZWHLCODE,
DECIMAL( CASE WHEN REPLACE(ZLOTSIZE,',','') = '' THEN 0
  ELSE REPLACE(ZLOTSIZE,',','') END,11,1),
DECIMAL( CASE WHEN REPLACE(ZLEADTIME,',','') = '' THEN 0
  ELSE REPLACE(ZLEADTIME,',','') END,3,0),
DECIMAL( CASE WHEN REPLACE(ZMOVCOST,',','') = '' THEN 0
	ELSE REPLACE(ZMOVCOST,',','') END,15,6),
DECIMAL( CASE WHEN REPLACE(ZRCPCOST,',','') = '' THEN 0
	ELSE REPLACE(ZRCPCOST,',','') END,15,6),
DECIMAL( CASE WHEN REPLACE(ZMOVCOST,',','') = '' THEN 0
	ELSE REPLACE(ZMOVCOST,',','') END,15,6),
ZWKCT,ZGRAD,ZALTNO,ZFMDT,ZTODT,ZCALC,ZEXPLANT,ZEXDIV,ZCOMCD,'',0
FROM PBPDM.BOM015
WHERE ZCMCD = '01' AND ZDATE >= '201001' AND ZDATE <= '201009' 