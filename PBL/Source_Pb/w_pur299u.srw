$PBExportHeader$w_pur299u.srw
$PBExportComments$구매운영window
forward
global type w_pur299u from w_origin_sheet09
end type
type tab_1 from tab within w_pur299u
end type
type tabpage_1 from userobject within tab_1
end type
type sle_1 from singlelineedit within tabpage_1
end type
type cb_23 from commandbutton within tabpage_1
end type
type sle_15 from singlelineedit within tabpage_1
end type
type cb_15 from commandbutton within tabpage_1
end type
type cb_14 from commandbutton within tabpage_1
end type
type cb_13 from commandbutton within tabpage_1
end type
type cb_12 from commandbutton within tabpage_1
end type
type cb_6 from commandbutton within tabpage_1
end type
type cbx_1 from checkbox within tabpage_1
end type
type dw_3 from datawindow within tabpage_1
end type
type cb_5 from commandbutton within tabpage_1
end type
type sle_jumin from singlelineedit within tabpage_1
end type
type sle_birth from singlelineedit within tabpage_1
end type
type cb_4 from commandbutton within tabpage_1
end type
type cb_3 from commandbutton within tabpage_1
end type
type cb_2 from commandbutton within tabpage_1
end type
type dw_1 from datawindow within tabpage_1
end type
type cb_1 from commandbutton within tabpage_1
end type
type st_3 from statictext within tabpage_1
end type
type st_2 from statictext within tabpage_1
end type
type st_1 from statictext within tabpage_1
end type
type sle_itno1 from singlelineedit within tabpage_1
end type
type sle_itno from singlelineedit within tabpage_1
end type
type sle_vsrno from singlelineedit within tabpage_1
end type
type tabpage_1 from userobject within tab_1
sle_1 sle_1
cb_23 cb_23
sle_15 sle_15
cb_15 cb_15
cb_14 cb_14
cb_13 cb_13
cb_12 cb_12
cb_6 cb_6
cbx_1 cbx_1
dw_3 dw_3
cb_5 cb_5
sle_jumin sle_jumin
sle_birth sle_birth
cb_4 cb_4
cb_3 cb_3
cb_2 cb_2
dw_1 dw_1
cb_1 cb_1
st_3 st_3
st_2 st_2
st_1 st_1
sle_itno1 sle_itno1
sle_itno sle_itno
sle_vsrno sle_vsrno
end type
type tabpage_2 from userobject within tab_1
end type
type cb_25 from commandbutton within tabpage_2
end type
type dw_22 from datawindow within tabpage_2
end type
type dw_21 from datawindow within tabpage_2
end type
type tabpage_2 from userobject within tab_1
cb_25 cb_25
dw_22 dw_22
dw_21 dw_21
end type
type tabpage_3 from userobject within tab_1
end type
type cb_22 from commandbutton within tabpage_3
end type
type dw_6 from datawindow within tabpage_3
end type
type cb_8 from commandbutton within tabpage_3
end type
type cb_7 from commandbutton within tabpage_3
end type
type dw_31 from datawindow within tabpage_3
end type
type tabpage_3 from userobject within tab_1
cb_22 cb_22
dw_6 dw_6
cb_8 cb_8
cb_7 cb_7
dw_31 dw_31
end type
type tabpage_4 from userobject within tab_1
end type
type cb_27 from commandbutton within tabpage_4
end type
type dw_45 from datawindow within tabpage_4
end type
type cb_26 from commandbutton within tabpage_4
end type
type cb_20 from commandbutton within tabpage_4
end type
type dw_44 from datawindow within tabpage_4
end type
type dw_43 from datawindow within tabpage_4
end type
type cb_19 from commandbutton within tabpage_4
end type
type cb_18 from commandbutton within tabpage_4
end type
type dw_42 from datawindow within tabpage_4
end type
type cb_9 from commandbutton within tabpage_4
end type
type dw_41 from datawindow within tabpage_4
end type
type tabpage_4 from userobject within tab_1
cb_27 cb_27
dw_45 dw_45
cb_26 cb_26
cb_20 cb_20
dw_44 dw_44
dw_43 dw_43
cb_19 cb_19
cb_18 cb_18
dw_42 dw_42
cb_9 cb_9
dw_41 dw_41
end type
type tabpage_5 from userobject within tab_1
end type
type dw_51 from datawindow within tabpage_5
end type
type cb_21 from commandbutton within tabpage_5
end type
type cb_11 from commandbutton within tabpage_5
end type
type ole_1 from olecontrol within tabpage_5
end type
type cb_10 from commandbutton within tabpage_5
end type
type tabpage_5 from userobject within tab_1
dw_51 dw_51
cb_21 cb_21
cb_11 cb_11
ole_1 ole_1
cb_10 cb_10
end type
type tabpage_6 from userobject within tab_1
end type
type dw_4 from datawindow within tabpage_6
end type
type tabpage_6 from userobject within tab_1
dw_4 dw_4
end type
type tabpage_7 from userobject within tab_1
end type
type dw_5 from datawindow within tabpage_7
end type
type tabpage_7 from userobject within tab_1
dw_5 dw_5
end type
type tabpage_8 from userobject within tab_1
end type
type cb_16 from commandbutton within tabpage_8
end type
type dw_81 from datawindow within tabpage_8
end type
type tabpage_8 from userobject within tab_1
cb_16 cb_16
dw_81 dw_81
end type
type tabpage_9 from userobject within tab_1
end type
type cb_17 from commandbutton within tabpage_9
end type
type dw_92 from datawindow within tabpage_9
end type
type cb_91 from commandbutton within tabpage_9
end type
type dw_91 from datawindow within tabpage_9
end type
type tabpage_9 from userobject within tab_1
cb_17 cb_17
dw_92 dw_92
cb_91 cb_91
dw_91 dw_91
end type
type tabpage_10 from userobject within tab_1
end type
type cb_24 from commandbutton within tabpage_10
end type
type dw_101 from datawindow within tabpage_10
end type
type tabpage_10 from userobject within tab_1
cb_24 cb_24
dw_101 dw_101
end type
type tabpage_11 from userobject within tab_1
end type
type dw_111 from datawindow within tabpage_11
end type
type tabpage_11 from userobject within tab_1
dw_111 dw_111
end type
type tab_1 from tab within w_pur299u
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_6 tabpage_6
tabpage_7 tabpage_7
tabpage_8 tabpage_8
tabpage_9 tabpage_9
tabpage_10 tabpage_10
tabpage_11 tabpage_11
end type
end forward

global type w_pur299u from w_origin_sheet09
string title = "업체별 품목단가관리"
event ue_open_after ( )
tab_1 tab_1
end type
global w_pur299u w_pur299u

type variables
integer ii_tabindex
String is_vsrno, is_xpay,  is_year, is_xplant, is_div, is_itno ,is_dept //주관부서
datawindow  idw_11, idw_12, idw_13, idw_14, idw_21, idw_22, idw_23, idw_31,idw_32,idw_41, idw_42, idw_43, idw_44, idw_45
datawindow  idw_51, idw_52, idw_53, idw_61, idw_71, idw_81, idw_91, idw_92, idw_101, idw_111
string is_colnm
window iw_sheet
end variables

event ue_open_after();iw_sheet = w_frame.getactivesheet()

//tab_1.tabpage_2.sle_file.text = 'C:\UPLOAD\XPLAN.xls'
end event

on w_pur299u.create
int iCurrent
call super::create
this.tab_1=create tab_1
iCurrent=UpperBound(this.Control)
this.Control[iCurrent+1]=this.tab_1
end on

on w_pur299u.destroy
call super::destroy
destroy(this.tab_1)
end on

event ue_bcreate;call super::ue_bcreate;Choose case ii_tabindex
	case 1
		if idw_11.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_11)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if
	case 2
		if idw_21.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_21)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if
	case 6
		if idw_61.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_61)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if
	case 7
		if idw_71.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_71)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if	
	case 8
		if idw_81.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_81)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if	
	case 9
		if idw_91.rowcount() > 0 then
			uo_status.st_message.text	=	'자료생성중입니다.잠시만 기다리세요'
			f_save_to_excel(idw_91)
			uo_status.st_message.text	=	' '
		else
			uo_status.st_message.text	=	'생성할 자료가 없습니다'
		end if			
End choose
end event

event ue_dprint;call super::ue_dprint;f_screen_print(this)
end event

event open;call super::open;this.event post ue_open_after()
end event

event ue_retrieve;call super::ue_retrieve;long ll_row,ll_rcnt

setpointer(hourglass!)
Choose case ii_tabindex
////***************************************************************************//	
Case 2
//		if idw_21.AcceptText() = -1 then
//			messagebox('확인','에러난곳 수정후 upload하세요!',Exclamation!)
//			return
//		end if
      idw_21.reset()
		f_pur040_getexcel(idw_21)
		ll_row = idw_21.rowcount()
//		IF idw_21.RowCount() > 0 Then
//			IF MessageBox("UPLOAD","작업중인 자료가 존재합니다. ~r~n~r~n무시하고 UPLOAD작업을 진행하시겠습니까?",Question!,YesNo!, 2)  =  2 THEN
//				RETURN
//			End IF	
//	   END IF
//		idw_21.Reset()
//		ll_row = idw_21.ImportFile(tab_1.tabpage_2.sle_file.text)
//      tab_1.tabpage_2.em_cnt.text = String(ll_row,"###,###")
//		
//		IF ll_row > 0 Then
//			uo_status.st_message.text = "데이타가 윈도우에 Load되었습니다. 확인후 UpLoad하세요"
//      ElseIF ll_row = 0 Then
//			uo_status.st_message.text = "실패, 0  End of file; too many rows "
//		ElseIF ll_row = -1 Then
//			uo_status.st_message.text = "실패, -1  No rows "
//		ElseIF ll_row = -2 Then
//			uo_status.st_message.text = "실패, -2  Empty file "			
//		ElseIF ll_row = -3 Then
//			uo_status.st_message.text = "실패, -3  Invalid argument "
//      ElseIF ll_row = -4 Then
//			uo_status.st_message.text = "실패, -4  Invalid input "
//		ElseIF ll_row = -5 Then
//			uo_status.st_message.text = "실패, -5  Could not open the file "	
//		ElseIF ll_row = -6 Then
//			uo_status.st_message.text = "실패, -6  Could not close the file "		
//		ElseIF ll_row = -7 Then
//			uo_status.st_message.text = "실패, -7  Error reading the text "
//		ElseIF ll_row = -8 Then
//			uo_status.st_message.text = "실패, -8  파일 속성이 다릅니다. Not a TXT file "
//		ElseIF ll_row = -9 Then
//			uo_status.st_message.text = "실패, -9  The user canceled the import "
//		ElseIF ll_row = -10 Then
//			uo_status.st_message.text = "실패, -10 Unsupported dBase file format (not version 2 or 3) "
//		End IF
		if ll_row > 0 then
			wf_icon_onoff(true,false,true,false,false,false,false,true,false)	
		else
			wf_icon_onoff(true,false,false,false,false,false,false,true,false)	
		end if
      uo_status.st_message.text = 'UPLOAD성공' + 'Count:' + string(ll_row) 
//***************************************************************************//
Case 3
		//idw_31.retrieve()
		idw_32.reset()
		f_pur040_getexcel(idw_32)
Case 4 //Excel UpLoad
	  //idw_41.retrieve()
	  //idw_42.reset()
	  //f_pur040_getexcel(idw_42)
	  idw_44.retrieve()
	  ll_row = idw_44.rowcount()
	  if ll_row > 0 then
			wf_icon_onoff(true,false,true,false,false,true,false,true,false)	
		else
			wf_icon_onoff(true,false,false,false,false,false,false,true,false)	
		end if
      //uo_status.st_message.text = 'UPLOAD성공' + 'Count:' + string(ll_row) 
Case 5
	   idw_51.reset()
		idw_51.retrieve()		
case 6
	  idw_61.reset()
	  f_pur040_getexcel(idw_61)
	  ll_row = idw_61.rowcount()
	  if ll_row > 0 then
			wf_icon_onoff(true,false,true,false,false,true,false,true,false)	
		else
			wf_icon_onoff(true,false,false,false,false,false,false,true,false)	
		end if
      uo_status.st_message.text = 'UPLOAD성공' + 'Count:' + string(ll_row) 
Case 7
		idw_71.retrieve()		
		wf_icon_onoff(true,false,false,false,false,true,false,true,false)	
Case 10
		idw_101.retrieve()		
		wf_icon_onoff(true,false,false,false,false,true,false,true,false)		
Case 11
//		if idw_21.AcceptText() = -1 then
//			messagebox('확인','에러난곳 수정후 upload하세요!',Exclamation!)
//			return
//		end if
      string ls_command
		long ll_cnt
      idw_111.reset()
		f_pur040_getexcel(idw_111)
		if idw_111.rowcount() =  0 then
			return
		end if
		uo_status.st_message.text = '당첨번호 확인중' 
		for ll_row = 2 to idw_111.rowcount()
			   if idw_111.object.no1[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no1[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no1[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no1[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no1[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no1[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
				if idw_111.object.no2[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no2[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no2[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no2[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no2[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no2[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
				if idw_111.object.no3[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no3[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no3[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no3[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no3[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no3[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
				if idw_111.object.no4[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no4[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no4[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no4[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no4[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no4[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
				if idw_111.object.no5[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no5[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no5[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no5[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no5[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no5[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
				if idw_111.object.no6[1] = idw_111.object.no1[ll_row] &
				or idw_111.object.no6[1] = idw_111.object.no2[ll_row] &	
				or idw_111.object.no6[1] = idw_111.object.no3[ll_row] &	
				or idw_111.object.no6[1] = idw_111.object.no4[ll_row] &	
				or idw_111.object.no6[1] = idw_111.object.no5[ll_row] &	
				or idw_111.object.no6[1] = idw_111.object.no6[ll_row] then	
					ll_cnt = ll_cnt + 1
				end if
//		   	if idw_111.object.no1[1] = idw_111.object.no1[ll_row] then
//					ls_command	=	'no1' + ".Background.Color = " &            
//					+ "~'" + string(15780518) + "~'"
//					idw_111.modify(ls_command)
//				end if
            idw_111.object.cnt[ll_row] = ll_cnt
				ll_cnt = 0
				uo_status.st_message.text = '당첨번호 확인중:' + string(ll_row) + ' 번째' 
		next
		messagebox('확인','로또당첨확인완료!',Exclamation!)
End choose



end event

event ue_save;call super::ue_save;long ll_row, ll_rcnt
string ls_no,ls_itno, ls_xplan

setpointer(hourglass!)
Choose case ii_tabindex
	case 1
	case 2
		if idw_21.AcceptText() = -1 then
			messagebox('확인','에러난곳 수정후 upload하세요!',Exclamation!)
			return
		end if
		uo_status.st_message.text	=  'UPLOAD자료 확인중'
		for ll_row = 1 to idw_21.rowcount()
			 ls_no  = trim(idw_21.object.no[ll_row])
			 ls_itno  = trim(idw_21.object.itno[ll_row])
			 ls_xplan = trim(idw_21.object.xplan[ll_row])
			 if isnull(ls_no) or isnumber(ls_no) = false then
				 messagebox('확인','행:' + string(ls_no) + ' 행번호 확인하세요!',Exclamation!)
				 return
			 end if
			SELECT count(*)  
			INTO :ll_rcnt  
			FROM "PBINV"."INV002"  
			WHERE ( "PBINV"."INV002"."COMLTD" = '01' ) AND  
					( "PBINV"."INV002"."ITNO" = :ls_itno )   ;
			if ll_rcnt = 0 then
				messagebox('확인','행:' + string(ls_no) + '품번:' + ls_itno + ' MASTER등록안된 품번입니다. 확인하세요!',Exclamation!)
				return
			end if
							
			SELECT count(*)  
			INTO :ll_rcnt  
			FROM "PBINV"."INV101"  
			WHERE ( "PBINV"."INV101"."COMLTD" = '01' ) AND  
					( "PBINV"."INV101"."ITNO" = :ls_itno )   ;
			if ll_rcnt = 0 then
				messagebox('확인','행:' + string(ls_no) + '품번:' + ls_itno + ' BALANCE등록안된 품번입니다. 확인하세요!',Exclamation!)
				return
			end if
						
			SELECT count(*)  
			INTO :ll_rcnt  
			FROM "PBCOMMON"."DAC002"  
			WHERE ( "PBCOMMON"."DAC002"."COMLTD" = '01' ) AND  
					( "PBCOMMON"."DAC002"."COGUBUN" = 'INV050' ) AND  
					( "PBCOMMON"."DAC002"."COCODE" = :ls_xplan )   ;
			if ll_rcnt = 0 then
				messagebox('확인','행:' + string(ls_no) + '담당:' + ls_xplan + ' 등록안된 담당코드입니다. 확인하세요!',Exclamation!)
				return
			end if

		next
		//***************************************************//
		uo_status.st_message.text	=  'UPLOAD자료 확정중...'
		for ll_row = 1 to idw_21.rowcount()
			 ls_no  = trim(idw_21.object.no[ll_row])
			 ls_itno  = trim(idw_21.object.itno[ll_row])
			 ls_xplan = trim(idw_21.object.xplan[ll_row])
			 
			 UPDATE "PBINV"."INV002"  
          SET "XPLAN" = :ls_xplan  
			 WHERE ( "PBINV"."INV002"."COMLTD" = '01' ) AND  
					 ( "PBINV"."INV002"."ITNO" = :ls_itno )   
					  ;
			 if sqlca.sqlcode <> 0 then
					messagebox('확인','행:' + string(ls_no) + '품번:' + ls_itno + 'MASTER담당수정중 오류발생. 확인하세요!',Exclamation!)
			      return
			 end if	
			 
          UPDATE "PBINV"."INV101"  
			 SET "XPLAN" = :ls_xplan  
			 WHERE ( "PBINV"."INV101"."COMLTD" = '01' ) AND  
					( "PBINV"."INV101"."ITNO" = :ls_itno )   
					  ;
          if sqlca.sqlcode <> 0 then
				 messagebox('확인','행:' + string(ls_no) + '품번:' + ls_itno + ' BALANCE담당수정중 오류발생. 확인하세요!',Exclamation!)
			    return
			 end if	
		next
		uo_status.st_message.text	=  '작업완료!'
	//***********************************************************************//구매실적
	case 6
		string ls_vsrno, ls_itnm, ls_spec
		long ll_amt
		if idw_61.AcceptText() = -1 then
			messagebox('확인','에러난곳 수정후 upload하세요!',Exclamation!)
			return
		end if
		uo_status.st_message.text	=  '자료 생성중'
		for ll_row = 1 to idw_61.rowcount()
			ls_itno = trim(idw_61.object.itno[ll_row])
			ls_vsrno = trim(idw_61.object.vsrno[ll_row])
			ll_amt = 0
			SELECT coalesce("PBINV"."INV203"."RPAMT" , 0)
			INTO :ll_amt  
			FROM "PBINV"."INV203"  
			WHERE ( "PBINV"."INV203"."COMLTD" = '01' ) AND  
					( "PBINV"."INV203"."XYEAR" = '2002' ) AND  
					( "PBINV"."INV203"."MM" = ' ' ) AND  
					( "PBINV"."INV203"."DEPT" = 'P' ) AND  
					( "PBINV"."INV203"."VSRNO" = :ls_vsrno ) AND  
					( "PBINV"."INV203"."ITNO" = :ls_itno )   
					  ;
         idw_61.object.amt[ll_row] = ll_amt
			ll_amt = 0
			SELECT coalesce("PBINV"."INV203"."RPAMT" , 0)
			INTO :ll_amt  
			FROM "PBINV"."INV203"  
			WHERE ( "PBINV"."INV203"."COMLTD" = '01' ) AND  
					( "PBINV"."INV203"."XYEAR" = '2003' ) AND  
					( "PBINV"."INV203"."MM" = ' ' ) AND  
					( "PBINV"."INV203"."DEPT" = 'P' ) AND  
					( "PBINV"."INV203"."VSRNO" = :ls_vsrno ) AND  
					( "PBINV"."INV203"."ITNO" = :ls_itno )   
					  ;
         idw_61.object.amt1[ll_row] = ll_amt
			SELECT "PBINV"."INV002"."ITNM",   
					"PBINV"."INV002"."SPEC"  
			INTO :ls_itnm,   
				  :ls_spec  
			FROM "PBINV"."INV002"  
			WHERE ( "PBINV"."INV002"."COMLTD" = '01' ) AND  
					( "PBINV"."INV002"."ITNO" = :ls_itno )   
						  ;

			idw_61.object.itnm[ll_row] = ls_itnm
			idw_61.object.spec[ll_row] = ls_spec
		next
		
End choose



end event

event ue_delete;call super::ue_delete;long ll_row
Choose case ii_tabindex
	case 3
		for ll_row = idw_31.rowcount() to 1 step -1
			if idw_31.Isselected(ll_row) then
				idw_31.deleterow(ll_row)
			end if
		next
	case 4
		for ll_row = idw_41.rowcount() to 1 step -1
			if idw_41.Isselected(ll_row) then
				idw_41.deleterow(ll_row)
			end if
		next	
End choose
end event

type uo_status from w_origin_sheet09`uo_status within w_pur299u
end type

type tab_1 from tab within w_pur299u
integer x = 23
integer y = 24
integer width = 4553
integer height = 2448
integer taborder = 60
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long backcolor = 12632256
boolean multiline = true
boolean raggedright = true
boolean focusonbuttondown = true
integer selectedtab = 1
tabpage_1 tabpage_1
tabpage_2 tabpage_2
tabpage_3 tabpage_3
tabpage_4 tabpage_4
tabpage_5 tabpage_5
tabpage_6 tabpage_6
tabpage_7 tabpage_7
tabpage_8 tabpage_8
tabpage_9 tabpage_9
tabpage_10 tabpage_10
tabpage_11 tabpage_11
end type

on tab_1.create
this.tabpage_1=create tabpage_1
this.tabpage_2=create tabpage_2
this.tabpage_3=create tabpage_3
this.tabpage_4=create tabpage_4
this.tabpage_5=create tabpage_5
this.tabpage_6=create tabpage_6
this.tabpage_7=create tabpage_7
this.tabpage_8=create tabpage_8
this.tabpage_9=create tabpage_9
this.tabpage_10=create tabpage_10
this.tabpage_11=create tabpage_11
this.Control[]={this.tabpage_1,&
this.tabpage_2,&
this.tabpage_3,&
this.tabpage_4,&
this.tabpage_5,&
this.tabpage_6,&
this.tabpage_7,&
this.tabpage_8,&
this.tabpage_9,&
this.tabpage_10,&
this.tabpage_11}
end on

on tab_1.destroy
destroy(this.tabpage_1)
destroy(this.tabpage_2)
destroy(this.tabpage_3)
destroy(this.tabpage_4)
destroy(this.tabpage_5)
destroy(this.tabpage_6)
destroy(this.tabpage_7)
destroy(this.tabpage_8)
destroy(this.tabpage_9)
destroy(this.tabpage_10)
destroy(this.tabpage_11)
end on

event selectionchanged;uo_status.st_message.text	=  ''
ii_tabindex = newindex
g_n_tabno = newindex
//Choose case ii_tabindex
//	case 1
////      if idw_11.rowcount() > 0 and (idw_11.getitemstatus(1, 0, primary!) = New! or &
////		   idw_11.getitemstatus(1, 0, primary!) = Newmodified!) then 
////		  wf_icon_onoff(true,true,true,false,false,true,false,true,false)   //I,A,U,D,P
////	   elseif idw_11.rowcount() > 0 then //조회
////		  wf_icon_onoff(true,true,false,true,false,true,false,true,false)   //I,A,U,D,P
////	   else  //자료없음
////		  wf_icon_onoff(true,true,false,false,false,false,false,true,false) //I,A,U,D,P
////	   end if
//	Case 2  //조정list
//		if idw_21.rowcount() > 0 then 
//		  wf_icon_onoff(true,false,true,false,false,false,false,true,false) //I,A,U,D,P
//	   else
//		  wf_icon_onoff(true,false,false,false,false,false,false,true,false) //I,A,U,D,P
//	   end if
//	Case 3  
//		if idw_31.rowcount() > 0 then 
//		  wf_icon_onoff(true,false,false,true,false,false,false,true,false) //I,A,U,D,P
//	   else
//		  wf_icon_onoff(true,false,false,true,false,false,false,true,false) //I,A,U,D,P
//	   end if	
//	Case 4  
//		if idw_41.rowcount() > 0 then 
//		  wf_icon_onoff(true,false,false,true,false,false,false,true,false) //I,A,U,D,P
//	   else
//		  wf_icon_onoff(true,false,false,true,false,false,false,true,false) //I,A,U,D,P
//	   end if		
// End choose
 wf_icon_onoff(true,true,true,true,true,true,false,true,false) //I,A,U,D,P
 
end event

type tabpage_1 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "장기품목전환및기타"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
sle_1 sle_1
cb_23 cb_23
sle_15 sle_15
cb_15 cb_15
cb_14 cb_14
cb_13 cb_13
cb_12 cb_12
cb_6 cb_6
cbx_1 cbx_1
dw_3 dw_3
cb_5 cb_5
sle_jumin sle_jumin
sle_birth sle_birth
cb_4 cb_4
cb_3 cb_3
cb_2 cb_2
dw_1 dw_1
cb_1 cb_1
st_3 st_3
st_2 st_2
st_1 st_1
sle_itno1 sle_itno1
sle_itno sle_itno
sle_vsrno sle_vsrno
end type

on tabpage_1.create
this.sle_1=create sle_1
this.cb_23=create cb_23
this.sle_15=create sle_15
this.cb_15=create cb_15
this.cb_14=create cb_14
this.cb_13=create cb_13
this.cb_12=create cb_12
this.cb_6=create cb_6
this.cbx_1=create cbx_1
this.dw_3=create dw_3
this.cb_5=create cb_5
this.sle_jumin=create sle_jumin
this.sle_birth=create sle_birth
this.cb_4=create cb_4
this.cb_3=create cb_3
this.cb_2=create cb_2
this.dw_1=create dw_1
this.cb_1=create cb_1
this.st_3=create st_3
this.st_2=create st_2
this.st_1=create st_1
this.sle_itno1=create sle_itno1
this.sle_itno=create sle_itno
this.sle_vsrno=create sle_vsrno
this.Control[]={this.sle_1,&
this.cb_23,&
this.sle_15,&
this.cb_15,&
this.cb_14,&
this.cb_13,&
this.cb_12,&
this.cb_6,&
this.cbx_1,&
this.dw_3,&
this.cb_5,&
this.sle_jumin,&
this.sle_birth,&
this.cb_4,&
this.cb_3,&
this.cb_2,&
this.dw_1,&
this.cb_1,&
this.st_3,&
this.st_2,&
this.st_1,&
this.sle_itno1,&
this.sle_itno,&
this.sle_vsrno}
end on

on tabpage_1.destroy
destroy(this.sle_1)
destroy(this.cb_23)
destroy(this.sle_15)
destroy(this.cb_15)
destroy(this.cb_14)
destroy(this.cb_13)
destroy(this.cb_12)
destroy(this.cb_6)
destroy(this.cbx_1)
destroy(this.dw_3)
destroy(this.cb_5)
destroy(this.sle_jumin)
destroy(this.sle_birth)
destroy(this.cb_4)
destroy(this.cb_3)
destroy(this.cb_2)
destroy(this.dw_1)
destroy(this.cb_1)
destroy(this.st_3)
destroy(this.st_2)
destroy(this.st_1)
destroy(this.sle_itno1)
destroy(this.sle_itno)
destroy(this.sle_vsrno)
end on

type sle_1 from singlelineedit within tabpage_1
integer x = 2683
integer y = 1212
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
string text = "none"
borderstyle borderstyle = stylelowered!
end type

type cb_23 from commandbutton within tabpage_1
integer x = 2213
integer y = 1220
integer width = 457
integer height = 92
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "RGB테스트"
end type

event clicked;//RGB값 찾기

// 15780518 ,        16777215 ,    12632256  ,      65535
//	  sky               white         gray           yellow
//rgb(160,200,239)  (255,255,255)  (192,192,192)  (255,255,0) CREAM(255,255,239)  
long  ll_r = 200  
long  ll_g = 220 
long  ll_b = 220
long  ll_row, ll_row1, ll_row2
int  li_ok

for ll_r = 100 to 255
      tab_1.tabpage_1.sle_1.backcolor = rgb(ll_r,ll_g,ll_b)
		li_ok = MessageBox(string(ll_r) + ':' + string(ll_g) + ':' + string(ll_b), &
		        '', &
	   Exclamation!, OKCancel!, 2)
		IF li_ok <> 1 THEN
			 return
		END IF
		ll_r = ll_r + 5
next	

//for ll_g = 100 to 255
//      tab_1.tabpage_1.sle_1.backcolor = rgb(ll_r,ll_g,ll_b)
//		li_ok = MessageBox(string(ll_r) + ':' + string(ll_g) + ':' + string(ll_b), &
//		        '', &
//	   Exclamation!, OKCancel!, 2)
//		IF li_ok <> 1 THEN
//			 return
//		END IF
//		ll_g = ll_g + 5
//		
//next	

//for ll_b = 100 to 255
//      tab_1.tabpage_1.sle_1.backcolor = rgb(ll_r,ll_g,ll_b)
//		li_ok = MessageBox(string(ll_r) + ':' + string(ll_g) + ':' + string(ll_b), &
//		        '', &
//	   Exclamation!, OKCancel!, 2)
//		IF li_ok <> 1 THEN
//			 return
//		END IF
//		//ll_g = ll_g + 5
//		ll_b = ll_b + 5
//next	



return
end event

type sle_15 from singlelineedit within tabpage_1
integer x = 3104
integer y = 48
integer width = 613
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
textcase textcase = upper!
integer limit = 12
borderstyle borderstyle = stylelowered!
end type

type cb_15 from commandbutton within tabpage_1
integer x = 2395
integer y = 48
integer width = 690
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "장기및품목단가수정"
end type

event clicked;setpointer(hourglass!)

string ls_frdt, ls_todt
string ls_vsrno, ls_itno
ls_vsrno = 'D0768'


ls_frdt = '20030106'
ls_todt = '20040106'
ls_itno = trim(tab_1.tabpage_1.sle_15.text)
if ls_itno = '' then
	messagebox('','품번없음')
	return
end if
//ls_itno = '740019D'
//적용일변경
  UPDATE "PBPUR"."PUR103"  
     SET "DADJDT" = :ls_todt  
   WHERE ( "PBPUR"."PUR103"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR103"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR103"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR103"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR103"."ITNO" = :ls_itno )   
           ;
  UPDATE "PBPUR"."PUR104"  
     SET "ADJDT" = :ls_todt  
   WHERE ( "PBPUR"."PUR104"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR104"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR104"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR104"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR104"."ITNO" = :ls_itno ) AND  
         ( "PBPUR"."PUR104"."ADJDT" = :ls_frdt )   
           ;
  UPDATE "PBPUR"."PUR105"  
     SET "CHGDT" = :ls_todt  
   WHERE ( "PBPUR"."PUR105"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR105"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR105"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR105"."ITNO" = :ls_itno )   
           ;

   UPDATE "PBPUR"."PUR114"  
     SET "CHGDT" = :ls_todt  
   WHERE ( "PBPUR"."PUR114"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR114"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR114"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR114"."ITNO" = :ls_itno ) AND  
         ( "PBPUR"."PUR114"."CHGDT" = :ls_frdt )   
           ;

messagebox('','수정완료')
setpointer(arrow!)

end event

type cb_14 from commandbutton within tabpage_1
integer x = 2656
integer y = 200
integer width = 544
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "구매자금넘버링"
end type

event clicked;long ll_vndno
string ls_vsrno

DECLARE CUR_1 CURSOR FOR
   SELECT "PBPUR"."PUR102A"."VSRNO"  
    FROM "PBPUR"."PUR102A"  
    WHERE ( "PBPUR"."PUR102A"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR102A"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR102A"."BANK" = '4' ) 
	 order by vsrno		
           ;

  OPEN CUR_1;
 DO WHILE TRUE
	FETCH CUR_1 INTO  :ls_vsrno;
	if sqlca.sqlcode <> 0 then
		exit
	end if
	ll_vndno = ll_vndno + 1
	UPDATE "PBPUR"."PUR102A"  
   SET "VNDNO" = :ll_vndno  
   WHERE ( "PBPUR"."PUR102A"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR102A"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR102A"."VSRNO" = :ls_vsrno) and  
			( "PBPUR"."PUR102A"."BANK" = '4' )   
           ;

	
 LOOP
 CLOSE CUR_1;
end event

type cb_13 from commandbutton within tabpage_1
integer x = 2144
integer y = 204
integer width = 457
integer height = 92
integer taborder = 70
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "비밀번호확인"
end type

event clicked;blob ls_a

selectblob emp_pwd
into :ls_a
from pbcommon.comm121
where emp_no = '851179';

messagebox('',string(ls_a))

end event

type cb_12 from commandbutton within tabpage_1
integer x = 1472
integer y = 1220
integer width = 645
integer height = 100
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "외자발주금액set"
end type

event clicked;setpointer(hourglass!)
string ls_purno, ls_srno
dec {2} ld_pamt
long  ll_row

uo_status.st_message.text	=  '처리중..'
DECLARE cur_1 CURSOR FOR  
  SELECT "PBPUR"."OPM102"."PURNO","PBPUR"."OPM102"."SRNO",SUM("PBPUR"."OPM102"."PAMT")		
	FROM "PBPUR"."OPM102", "PBPUR"."OPM101"  
   WHERE ( "PBPUR"."OPM102"."COMLTD" =  "PBPUR"."OPM101"."COMLTD" ) AND  
	      ( "PBPUR"."OPM102"."PURNO"  =  "PBPUR"."OPM101"."PURNO" ) AND
			( "PBPUR"."OPM102"."SRNO"   =  "PBPUR"."OPM101"."SRNO" ) AND  
	      ( "PBPUR"."OPM101"."COMLTD" = '01' ) AND  
         ( "PBPUR"."OPM101"."PAMT"   = 0 )
	GROUP BY "PBPUR"."OPM102"."PURNO","PBPUR"."OPM102"."SRNO"		
           ;
OPEN CUR_1;
 DO WHILE TRUE
	FETCH CUR_1 INTO  :ls_purno, :ls_srno, :ld_pamt; 
	if sqlca.sqlcode <> 0  then
		exit
	end if
	ll_row = ll_row + 1
   UPDATE "PBPUR"."OPM101"  
      SET "PAMT" = :ld_pamt
//		   "UPDTID" = :g_s_empno,
//			"UPDTDT" = :g_s_datetime,
//			"IPADDR" = :g_s_macaddr,
//			"MACADDR" = :g_s_ipaddr
       WHERE ( "PBPUR"."OPM101"."COMLTD" = '01' ) AND  
         ( "PBPUR"."OPM101"."PURNO" = :ls_purno ) AND  
         ( "PBPUR"."OPM101"."SRNO"  = :ls_srno );			

   uo_status.st_message.text	=  string(ll_row) + '개 처리중'
LOOP
CLOSE CUR_1;
uo_status.st_message.text	=  string(ll_row) + '개 수정완료'

end event

type cb_6 from commandbutton within tabpage_1
integer x = 3200
integer y = 1408
integer width = 503
integer height = 108
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "기준단가생성"
end type

type cbx_1 from checkbox within tabpage_1
integer x = 1038
integer y = 1556
integer width = 274
integer height = 64
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
string text = "남자"
boolean checked = true
end type

type dw_3 from datawindow within tabpage_1
integer x = 1938
integer y = 1424
integer width = 1129
integer height = 688
integer taborder = 130
string title = "none"
string dataobject = "d_pur299u_11"
boolean hscrollbar = true
boolean vscrollbar = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

type cb_5 from commandbutton within tabpage_1
integer x = 1463
integer y = 1428
integer width = 457
integer height = 92
integer taborder = 120
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "생성"
end type

event clicked;string ls_birth, ls_jumin, jumin, ls_man
int value[13], i, h_mod, h_minus, h_last, last_jumin
long ll_row
ls_birth = trim(sle_birth.text)
//ls_jumin = trim(sle_jumin.text)
// 공백제거
setpointer(hourglass!)
//jumin = trim(jumin)
tab_1.tabpage_1.dw_3.reset()
if cbx_1.checked = true then
	ls_man = '1'
else
	ls_man = '2'
end if
// 길이가 반드시 13이어야 함.
//if len(jumin) <> 13 then return -1

//2000년대에 태어난 남자는 '3' 여자는 '4'로 구분함
//하지만 현재 사원이나 입사할 사원중에는 당분간 없을 듯…
Do while true
	ls_jumin = ls_man + string(Rand(999999),"000000")
	jumin = ls_birth + ls_jumin
	//if not (mid(jumin,7,1)="1" or mid(jumin,7,1)="2") then return -1
	
	last_jumin = dec(Mid(jumin,13,1))
	
	value[1]   = dec(Mid(jumin,1,1))  * 2
	value[2]   = dec(Mid(jumin,2,1))  * 3
	value[3]   = dec(Mid(jumin,3,1))  * 4
	value[4]   = dec(Mid(jumin,4,1))  * 5
	value[5]   = dec(Mid(jumin,5,1))  * 6
	value[6]   = dec(Mid(jumin,6,1))  * 7
	value[7]   = dec(Mid(jumin,7,1))  * 8
	value[8]   = dec(Mid(jumin,8,1))  * 9
	value[9]   = dec(Mid(jumin,9,1))  * 2
	value[10]  = dec(Mid(jumin,10,1)) * 3
	value[11]  = dec(Mid(jumin,11,1)) * 4
	value[12]  = dec(Mid(jumin,12,1)) * 5
	value[13]  = 0
	
	for i = 1 to 12
		value[13] = value[13] + value[i]
	next
	
	h_mod = mod(value[13],11)  //나머지
	h_minus = 11 - h_mod
	h_last = mod(h_minus,10)
	
	if h_last <> last_jumin then
	  // 틀린주민번호
	else
	  // 맞는 주민번호
	  ll_row = tab_1.tabpage_1.dw_3.insertrow(0)
	  tab_1.tabpage_1.dw_3.object.a[ll_row] = mid(jumin,1,6)
	  tab_1.tabpage_1.dw_3.object.b[ll_row] = mid(jumin,7,7)
	end if
	if ll_row = 10 then
		exit
	end if
Loop

end event

type sle_jumin from singlelineedit within tabpage_1
integer x = 1038
integer y = 1428
integer width = 370
integer height = 92
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
integer limit = 7
borderstyle borderstyle = stylelowered!
end type

type sle_birth from singlelineedit within tabpage_1
integer x = 585
integer y = 1428
integer width = 366
integer height = 92
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
integer limit = 6
borderstyle borderstyle = stylelowered!
end type

type cb_4 from commandbutton within tabpage_1
integer x = 96
integer y = 1424
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "주민"
end type

event clicked;string ls_birth, ls_jumin, jumin
int value[13], i, h_mod, h_minus, h_last, last_jumin

jumin = trim(sle_birth.text) + trim(sle_jumin.text)
// 공백제거
jumin = trim(jumin)

// 길이가 반드시 13이어야 함.
if len(jumin) <> 13 then 
	messagebox('확인','주민번호확인바랍니다',Exclamation!)
	return
end if

//2000년대에 태어난 남자는 '3' 여자는 '4'로 구분함
//하지만 현재 사원이나 입사할 사원중에는 당분간 없을 듯…
if not (mid(jumin,7,1)="1" or mid(jumin,7,1)="2") then return 

last_jumin = dec(Mid(jumin,13,1))
value[1]   = dec(Mid(jumin,1,1))  * 2
value[2]   = dec(Mid(jumin,2,1))  * 3
value[3]   = dec(Mid(jumin,3,1))  * 4
value[4]   = dec(Mid(jumin,4,1))  * 5
value[5]   = dec(Mid(jumin,5,1))  * 6
value[6]   = dec(Mid(jumin,6,1))  * 7
value[7]   = dec(Mid(jumin,7,1))  * 8
value[8]   = dec(Mid(jumin,8,1))  * 9
value[9]   = dec(Mid(jumin,9,1))  * 2
value[10]  = dec(Mid(jumin,10,1)) * 3
value[11]  = dec(Mid(jumin,11,1)) * 4
value[12]  = dec(Mid(jumin,12,1)) * 5
value[13]  = 0

for i = 1 to 12
   value[13] = value[13] + value[i]
next

h_mod = mod(value[13],11)  //나머지
h_minus = 11 - h_mod
h_last = mod(h_minus,10)

if h_last <> last_jumin then
	messagebox('확인','틀린번호!',Exclamation!)
  // 틀린주민번호
  return 
else
	messagebox('확인','맞는번호!',Exclamation!)
  // 맞는 주민번호
  return 
end if

end event

type cb_3 from commandbutton within tabpage_1
integer x = 727
integer y = 1228
integer width = 512
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "B/L번호수정"
end type

event clicked;UPDATE
PBPUR.OPM106
SET BLNO = 'LAXO0226311A3'
WHERE COMLTD = '01'
AND BLNO = 'LAXO0226311-3';
//messagebox('쭈','이뻐' + string(sqlca.sqlcode))
//return

UPDATE
PBPUR.OPM105
SET BLNO = 'LAXO0226311A3'
WHERE COMLTD = '01'
AND BLNO = 'LAXO0226311-3';

UPDATE
PBACC.ACC510
SET IBLNO = 'LAXO0226311A3'
WHERE COMLTD = '01'
AND IBLNO = 'LAXO0226311-3';

UPDATE
PBPUR.OPM105
SET BLNO = 'LAXO022636A2'
WHERE COMLTD = '01'
AND BLNO = 'LAXO022636-2';

UPDATE
PBPUR.OPM106
SET BLNO = 'LAXO022636A2'
WHERE COMLTD = '01'
AND BLNO = 'LAXO022636-2';

UPDATE
PBACC.ACC510
SET IBLNO = 'LAXO022636A2'
WHERE COMLTD = '01'
AND IBLNO = 'LAXO022636-2';


end event

type cb_2 from commandbutton within tabpage_1
integer x = 59
integer y = 1232
integer width = 608
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "발주번호수정(4/2)"
end type

event clicked;long ll_row = 1
//
setpointer(hourglass!)

ll_row = ll_row + 1
update  
pbpur.pur401
set purno = '62003040217'
where comltd = '01'
//and xplan = '8A'
and purno= '3040006';
if sqlca.sqlcode <> 0 then
	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
	return
end if

update  
pbpur.pur402
set purno = '62003040217'
where comltd = '01'
//and xplan = '8A'
and purno= '3040006';
if sqlca.sqlcode <> 0 then
	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
	return
end if


//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040238'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040019';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040238'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040019';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040239'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040020';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040239'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040020';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if


//update  
//pbpur.pur401
//set purno = '62003040213'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040002';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040213'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040002';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040214'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040003';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040214'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040003';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040215'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040004';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040215'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040004';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040216'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040005';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040216'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040005';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040218'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040007';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040218'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040007';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040219'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040008';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040219'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040008';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040220'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040009';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040220'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040009';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040221'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040010';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040221'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040010';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040222'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040011';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040222'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040011';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040223'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040012';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040223'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040012';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040224'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040013';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040224'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040013';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040225'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040014';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040225'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040014';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040226'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040015';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040226'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040015';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040227'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040016';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040227'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040016';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040228'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040018';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040228'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040018';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040229'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040021';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//update  
//pbpur.pur402
//set purno = '62003040229'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040021';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//
//ll_row = ll_row + 1
//update  
//pbpur.pur401
//set purno = '62003040230'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040022';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주head수정 오류발생'
//	return
//end if
//
//update  
//pbpur.pur402
//set purno = '62003040230'
//where comltd = '01'
////and xplan = '8A'
//and purno= '3040022';
//if sqlca.sqlcode <> 0 then
//	uo_status.st_message.text	=  '행:' + string(ll_row) + ' 발주detail수정 오류발생'
//	return
//end if
//uo_status.st_message.text	=  '작업완료!'
end event

type dw_1 from datawindow within tabpage_1
integer x = 23
integer y = 376
integer width = 3918
integer height = 736
integer taborder = 70
boolean bringtotop = true
string title = "none"
string dataobject = "d_pur904u_14"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_14 = this
end event

type cb_1 from commandbutton within tabpage_1
integer x = 1618
integer y = 204
integer width = 443
integer height = 92
integer taborder = 60
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "장기품목전환"
end type

event clicked;string ls_vsrno, ls_itno, ls_itno1, ls_adjdt

uo_status.st_message.text = ''

ls_vsrno = trim(tab_1.tabpage_1.sle_vsrno.text)
ls_itno = trim(tab_1.tabpage_1.sle_itno.text)
ls_itno1 = trim(tab_1.tabpage_1.sle_itno1.text)

   SELECT "PBPUR"."PUR103"."DADJDT"  
    INTO :ls_adjdt  
    FROM "PBPUR"."PUR103"  
   WHERE ( "PBPUR"."PUR103"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR103"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR103"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR103"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR103"."ITNO" = :ls_itno )   ;



  UPDATE "PBPUR"."PUR105"  
     SET "ITNO" = :ls_itno1, "CHGDT" = :ls_adjdt  
   WHERE ( "PBPUR"."PUR105"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR105"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR105"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR105"."ITNO" = :ls_itno )   
           ;
    if sqlca.sqlcode <> 0 then
		 messagebox('확인','장기품목update 오류') 
		 return
	 end if
	 
	UPDATE "PBPUR"."PUR114"  
   SET "ITNO" = :ls_itno1    
   WHERE ( "PBPUR"."PUR114"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR114"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR114"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR114"."ITNO" = :ls_itno )   
           ;
	 if sqlca.sqlcode <> 0 then
		 messagebox('확인','장기품목history update 오류') 
		 return
	 end if
	 
	UPDATE "PBPUR"."PUR114"  
   SET "CHGDT" = :ls_adjdt    
   WHERE ( "PBPUR"."PUR114"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR114"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR114"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR114"."ITNO" = :ls_itno1 )  and 
			( "PBPUR"."PUR114"."CHGDT" = (select max(chgdt) from "PBPUR"."PUR114"
			                               WHERE ( "PBPUR"."PUR114"."COMLTD" = '01' ) AND  
															( "PBPUR"."PUR114"."DEPT" = 'D' ) AND  
															( "PBPUR"."PUR114"."VSRNO" = :ls_vsrno ) AND  
															( "PBPUR"."PUR114"."ITNO" = :ls_itno1 )
										) 
				)						
           ;
uo_status.st_message.text = f_message("U010")
end event

type st_3 from statictext within tabpage_1
integer x = 1152
integer y = 124
integer width = 229
integer height = 52
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
string text = "TO품번"
boolean focusrectangle = false
end type

type st_2 from statictext within tabpage_1
integer x = 645
integer y = 120
integer width = 169
integer height = 52
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
string text = "품번"
boolean focusrectangle = false
end type

type st_1 from statictext within tabpage_1
integer x = 123
integer y = 120
integer width = 151
integer height = 52
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 33554432
long backcolor = 67108864
string text = "업체"
boolean focusrectangle = false
end type

type sle_itno1 from singlelineedit within tabpage_1
integer x = 1134
integer y = 204
integer width = 457
integer height = 92
integer taborder = 50
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 15780518
long backcolor = 15780518
borderstyle borderstyle = stylelowered!
end type

type sle_itno from singlelineedit within tabpage_1
integer x = 599
integer y = 204
integer width = 457
integer height = 92
integer taborder = 40
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 15780518
long backcolor = 15780518
borderstyle borderstyle = stylelowered!
end type

type sle_vsrno from singlelineedit within tabpage_1
integer x = 91
integer y = 204
integer width = 416
integer height = 92
integer taborder = 30
boolean bringtotop = true
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
long textcolor = 15780518
long backcolor = 15780518
borderstyle borderstyle = stylelowered!
end type

type tabpage_2 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "품목담당수정"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_25 cb_25
dw_22 dw_22
dw_21 dw_21
end type

on tabpage_2.create
this.cb_25=create cb_25
this.dw_22=create dw_22
this.dw_21=create dw_21
this.Control[]={this.cb_25,&
this.dw_22,&
this.dw_21}
end on

on tabpage_2.destroy
destroy(this.cb_25)
destroy(this.dw_22)
destroy(this.dw_21)
end on

type cb_25 from commandbutton within tabpage_2
integer x = 1495
integer y = 44
integer width = 576
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "업체 주담당 수정"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_dept, ls_vsrno, ls_code, ls_vndr
dec {2} ld_dcost,ld_xcost
SETpointer(hourglass!)

idw_22.reset()
f_pur040_getexcel(idw_22)


for ll_row = 1 to idw_22.rowcount()
	//ls_dept    = idw_22.object.dept[ll_row]
	ls_vndr   = idw_22.object.vndr[ll_row]
	//ls_code    = idw_22.object.code[ll_row]
	select count(*) into :ll_rcnt
	from pbpur.pur101
	where comltd = '01'
	and  vndr = :ls_vndr;
	if ll_rcnt = 0 then
		messagebox('확인',string(ll_row) + '행 ' + '사업자번호 없음')
		return
	end if
		
next


ll_rcnt = idw_22.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF

for ll_row = 1 to idw_22.rowcount()
	//ls_dept    = idw_22.object.dept[ll_row]
	ls_vndr    = trim(idw_22.object.vndr[ll_row])
	ls_code    = trim(idw_22.object.xplan1[ll_row])
	update pbpur.pur102
	  set  xplan1 = :ls_code
	where comltd = '01'
	and vsrno in ( select vsrno
	              from pbpur.pur101
					  where comltd = '01'
					  and scgubun = 'S'
					  and digubun = 'D'
	              and  vndr = :ls_vndr) ;
	if sqlca.sqlcode <> 0 then
		messagebox('확인',string(ll_row) + '행 ' + ls_vndr + ' 업체 정보 수정오류')
		return
	end if
		
next
SETpointer(arrow!)
uo_status.st_message.text = '작업완료'


end event

type dw_22 from datawindow within tabpage_2
integer x = 1490
integer y = 152
integer width = 960
integer height = 992
integer taborder = 90
string title = "none"
string dataobject = "d_pur299u_22"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_22 = this

end event

type dw_21 from datawindow within tabpage_2
integer x = 18
integer y = 32
integer width = 1449
integer height = 2216
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_21"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event itemerror;return 1
end event

event constructor;this.settransobject(sqlca)
idw_21 = this

end event

type tabpage_3 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "단가및적용일체크"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_22 cb_22
dw_6 dw_6
cb_8 cb_8
cb_7 cb_7
dw_31 dw_31
end type

on tabpage_3.create
this.cb_22=create cb_22
this.dw_6=create dw_6
this.cb_8=create cb_8
this.cb_7=create cb_7
this.dw_31=create dw_31
this.Control[]={this.cb_22,&
this.dw_6,&
this.cb_8,&
this.cb_7,&
this.dw_31}
end on

on tabpage_3.destroy
destroy(this.cb_22)
destroy(this.dw_6)
destroy(this.cb_8)
destroy(this.cb_7)
destroy(this.dw_31)
end on

type cb_22 from commandbutton within tabpage_3
integer x = 73
integer y = 952
integer width = 827
integer height = 92
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "외주기획 업체구분 수정"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_dept, ls_vsrno, ls_code
dec {2} ld_dcost,ld_xcost
SETpointer(hourglass!)
for ll_row = 1 to idw_32.rowcount()
	ls_dept    = idw_32.object.dept[ll_row]
	ls_vsrno   = idw_32.object.vsrno[ll_row]
	ls_code    = idw_32.object.code[ll_row]
	select count(*) into :ll_rcnt
	from pbpur.pur102
	where comltd = '01'
	and  dept = :ls_dept
	and  vsrno = :ls_vsrno ;
	if ll_rcnt = 0 then
		messagebox('확인',string(ll_row) + '행 ' + ls_dept + ls_vsrno + '주관부서/업체 정보 없음')
		//return
	end if
		
next


ll_rcnt = idw_32.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF

for ll_row = 1 to idw_32.rowcount()
	ls_dept    = idw_32.object.dept[ll_row]
	ls_vsrno   = idw_32.object.vsrno[ll_row]
	ls_code    = idw_32.object.code[ll_row]
	update pbpur.pur102
	set  grup1 = :ls_code
	where comltd = '01'
	and  dept = :ls_dept
	and  vsrno = :ls_vsrno ;
	if sqlca.sqlcode <> 0 then
		messagebox('확인',string(ll_row) + '행 ' + ls_dept + ls_vsrno + '주관부서/업체 정보 수정오류')
		return
	end if
		
next
SETpointer(arrow!)
uo_status.st_message.text = '작업완료'
end event

type dw_6 from datawindow within tabpage_3
integer x = 32
integer y = 1068
integer width = 3323
integer height = 780
integer taborder = 100
string title = "none"
string dataobject = "d_pur299u_32"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_32 = this
end event

type cb_8 from commandbutton within tabpage_3
integer x = 1157
integer y = 32
integer width = 768
integer height = 92
integer taborder = 100
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "실단가적용일=>장기적용"
end type

type cb_7 from commandbutton within tabpage_3
integer x = 55
integer y = 32
integer width = 1024
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "장기적용일=>실단가적용일"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_vsrno, ls_itno, ls_chgdt,ls_adjdt
dec {2} ld_dcost,ld_xcost

ll_rcnt = idw_31.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF
SETpointer(hourglass!)
for ll_row = 1 to idw_31.rowcount()
	ls_vsrno = idw_31.object.vsrno[ll_row]
	ls_itno = idw_31.object.itno[ll_row]
	ls_chgdt = idw_31.object.chgdt[ll_row]
	ls_adjdt = idw_31.object.dadjdt[ll_row]
	
	UPDATE "PBPUR"."PUR104"  
   SET "ADJDT" = :ls_chgdt  
   WHERE ( "PBPUR"."PUR104"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR104"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR104"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR104"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR104"."ITNO" = :ls_itno ) AND  
         ( "PBPUR"."PUR104"."ADJDT" = :ls_adjdt )   
           ;
	
	UPDATE "PBPUR"."PUR103"  
   SET "DADJDT" = :ls_chgdt  
   WHERE ( "PBPUR"."PUR103"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR103"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR103"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR103"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR103"."ITNO" = :ls_itno )   
           ;
		  
		
next
uo_status.st_message.text = '작업완료'
end event

type dw_31 from datawindow within tabpage_3
integer x = 27
integer y = 156
integer width = 3922
integer height = 732
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_31"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_31 = this
end event

event clicked;//This.SelectRow(0,False)
//This.SelectRow(row,True)
f_pur040_mselect(this, row)
//자료없는 부분 클릭시 선택 해제
IF dwo.name = "datawindow" Then
	This.SelectRow(0,false)
End IF
this.SetRedraw(False)
IF row < 1 THEN
   IF f_pur040_getobjph(this,is_colnm) = 1 THEN
		this.setsort(is_colnm)
      this.sort()
   END IF
END IF
this.SetRedraw(True)
end event

type tabpage_4 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "사유코드,이관,기타"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_27 cb_27
dw_45 dw_45
cb_26 cb_26
cb_20 cb_20
dw_44 dw_44
dw_43 dw_43
cb_19 cb_19
cb_18 cb_18
dw_42 dw_42
cb_9 cb_9
dw_41 dw_41
end type

on tabpage_4.create
this.cb_27=create cb_27
this.dw_45=create dw_45
this.cb_26=create cb_26
this.cb_20=create cb_20
this.dw_44=create dw_44
this.dw_43=create dw_43
this.cb_19=create cb_19
this.cb_18=create cb_18
this.dw_42=create dw_42
this.cb_9=create cb_9
this.dw_41=create dw_41
this.Control[]={this.cb_27,&
this.dw_45,&
this.cb_26,&
this.cb_20,&
this.dw_44,&
this.dw_43,&
this.cb_19,&
this.cb_18,&
this.dw_42,&
this.cb_9,&
this.dw_41}
end on

on tabpage_4.destroy
destroy(this.cb_27)
destroy(this.dw_45)
destroy(this.cb_26)
destroy(this.cb_20)
destroy(this.dw_44)
destroy(this.dw_43)
destroy(this.cb_19)
destroy(this.cb_18)
destroy(this.dw_42)
destroy(this.cb_9)
destroy(this.dw_41)
end on

type cb_27 from commandbutton within tabpage_4
integer x = 1147
integer y = 1412
integer width = 576
integer height = 92
integer taborder = 130
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "전자세금업체등록"
end type

event clicked;setpointer(hourglass!)

long ll_row, ll_rcnt
STRING ls_vsrno, ls_itno, ls_vndr
 idw_45.reset()
f_pur040_getexcel(idw_45)
idw_45.accepttext()
//ll_row = idw_21.rowcount()

uo_status.st_message.text = '확인중..'
for ll_row = 1 to idw_45.rowcount()
	//ls_vndr  = trim(idw_45.object.vndr[ll_row])
	ls_vsrno = trim(idw_45.object.vsrno[ll_row])
	ll_rcnt = 0
	
	select count(*) 
	into :ll_rcnt
	from pbpur.pur102a
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  dept  in ('P','Y','D');
	
	if ll_rcnt = 0 then
		messagebox('확인','행:' + string(ll_row) + ' 업체상세정보없음')
		return
	end if
	
//	ls_vsrno = ''
//	select vsrno 
//	into :ls_vsrno
//	from pbpur.pur101
//	where comltd = '01'
//	and  vndr = :ls_vndr
//	;
//	if trim(ls_vsrno) = '' then
//		messagebox('확인','행:' + string(ll_row) + ' 이관될(to)업체 사업자번호확인')
//		return
//	end if
		
next
uo_status.st_message.text = '확정중..'

ll_rcnt = idw_45.rowcount()
ll_row = MessageBox("확인", '업체: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
IF ll_row <> 1 THEN
  // Process CANCEL.
	// rollback using sqlca;
	 uo_status.st_message.text = '작업취소'
	 return
END IF


for ll_row = 1 to idw_45.rowcount()
	ls_vsrno = trim(idw_45.object.vsrno[ll_row])
	ll_rcnt = 0
	update pbpur.pur102a
	set  epaycd  = 'Y'
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  dept  in ('P','Y','D');
	
	
	
next
uo_status.st_message.text = '작업완료'

SETpointer(arrow!)
end event

type dw_45 from datawindow within tabpage_4
integer x = 23
integer y = 1376
integer width = 1083
integer height = 820
integer taborder = 130
string title = "none"
string dataobject = "d_pur299u_45"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;idw_45 = this
this.settransobject(sqlca)
end event

type cb_26 from commandbutton within tabpage_4
integer x = 1161
integer y = 1100
integer width = 544
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "EXTEND업체이관"
end type

event clicked;//PUR102A를 업체상세DB의 EXTEND로 사용.
//DATA MIGRATION

LONG ll_row
string ls_dept,ls_vsrno,ls_inptid,ls_inptdt,ls_updtid,ls_updtdt

setpointer(hourglass!)

DECLARE cur_1 CURSOR FOR  
  SELECT dept, vsrno,inptid,inptdt,
         updtid,updtdt  
	FROM pbpur.pur102
   WHERE comltd = '01' and
	      dept <> 'I' ;
OPEN CUR_1;
 DO WHILE TRUE
	FETCH CUR_1 INTO  :ls_dept,   :ls_vsrno,  :ls_inptid, 
	                  :ls_inptdt, :ls_updtid, :ls_updtdt;
	if sqlca.sqlcode <> 0  then
		exit
	end if
	select count(*) into :ll_row
	from  pbpur.pur102a
	where comltd = '01'
	and   dept   = :ls_dept
	and   vsrno  = :ls_vsrno ;
	if ll_row > 0 then
		continue
	end if
	  INSERT INTO "PBPUR"."PUR102A"  
         ( "COMLTD",   
           "DEPT",   
           "VSRNO",   
           "VNDNO",   
           "BANK",   
           "EXTD",   
           "INPTID",   
           "INPTDT",   
           "UPDTID",   
           "UPDTDT",   
           "IPADDR",   
           "MACADDR",   
           "EPAYCD" )  
  VALUES ( '01',   
           :ls_dept,   
           :ls_vsrno,   
           0,   
           '',   
           '',   
           :ls_inptid,   
           :ls_inptdt,   
           :ls_updtid,   
           :ls_updtdt,   
           '',   
           '',   
           '' )  ;

	
	LOOP
CLOSE CUR_1;
setpointer(arrow!)

end event

type cb_20 from commandbutton within tabpage_4
integer x = 1166
integer y = 984
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "발주업체변경"
end type

event clicked;setpointer(hourglass!)

long ll_row, ll_rcnt
STRING ls_sliptype, ls_srno, ls_srno1, ls_srno2, ls_purno

uo_status.st_message.text = '수정중..'
for ll_row = 1 to idw_44.rowcount()
	ls_srno      = trim(idw_44.object.pur402_srno[ll_row])
	ls_srno1     = trim(idw_44.object.pur402_srno1[ll_row])
	ls_purno     = trim(idw_44.object.pur402_purno[ll_row])
	ll_rcnt = 0
		
	update pbpur.pur401
	set  vsrno = 'D0710'
	where comltd = '01'
	and  purno = :ls_purno
	and  vsrno = 'D3149'
	;
	if sqlca.sqlcode <> 0 then
		messagebox('','pur401오류' + string(ll_row) + ':' + ls_purno )
	end if
	update pbpur.pur402
	set  vsrno = 'D0710'
	where comltd = '01'
	and  srno = :ls_srno
	and  srno1 = :ls_srno1
	and  vsrno = 'D3149'
	;
	if sqlca.sqlcode <> 0 then
		messagebox('','pur402' + string(ll_row) + ':' + ls_purno + 'code:' + string(sqlca.sqlcode))
	end if
	
	uo_status.st_message.text = string(ll_row) + '/' + string(idw_44.rowcount()) + ' 처리중..'
next
uo_status.st_message.text = '작업완료'

SETpointer(arrow!)
end event

type dw_44 from datawindow within tabpage_4
integer x = 1157
integer y = 556
integer width = 809
integer height = 400
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_44"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
end type

event constructor;idw_44 = this
this.settransobject(sqlca)
end event

type dw_43 from datawindow within tabpage_4
integer x = 1157
integer y = 144
integer width = 686
integer height = 400
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_43"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
end type

event constructor;idw_43 = this
this.settransobject(sqlca)
end event

type cb_19 from commandbutton within tabpage_4
integer x = 1166
integer y = 36
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "입고업체변경"
end type

event clicked;setpointer(hourglass!)

long ll_row, ll_rcnt
STRING ls_sliptype, ls_srno, ls_srno1, ls_srno2, ls_purno

uo_status.st_message.text = '수정중..'
for ll_row = 1 to idw_43.rowcount()
	ls_sliptype  = trim(idw_43.object.sliptype[ll_row])
	ls_srno      = trim(idw_43.object.srno[ll_row])
	ls_srno1     = trim(idw_43.object.srno1[ll_row])
	ls_srno2     = trim(idw_43.object.srno2[ll_row])
	ls_purno     = trim(idw_43.object.purno[ll_row])
	ll_rcnt = 0
	
	update pbinv.inv401
	set  vsrno = 'D3149'
	where comltd = '01'
	and  sliptype = :ls_sliptype
	and  srno   = :ls_srno
	and  srno1  = :ls_srno1
	and  srno2  = :ls_srno2
	;
	if sqlca.sqlcode <> 0 then
		messagebox('','트랜스오류' + string(ll_row) + ':' + ls_srno )
	end if
	update pbpur.pur401
	set  vsrno = 'D3149'
	where comltd = '01'
	and  purno = :ls_purno
	and  vsrno = 'D0710'
	;
	if sqlca.sqlcode <> 0 then
		messagebox('','pur401오류' + string(ll_row) + ':' + ls_purno )
	end if
	update pbpur.pur402
	set  vsrno = 'D3149'
	where comltd = '01'
	and  srno = :ls_srno
	and  srno1 = :ls_srno1
	and  vsrno = 'D0710'
	;
	if sqlca.sqlcode <> 0 then
		messagebox('','pur402' + string(ll_row) + ':' + ls_purno + 'code:' + string(sqlca.sqlcode))
	end if
	
	uo_status.st_message.text = string(ll_row) + '/' + string(idw_43.rowcount()) + ' 처리중..'
next
uo_status.st_message.text = '작업완료'

SETpointer(arrow!)
end event

type cb_18 from commandbutton within tabpage_4
integer x = 2181
integer y = 44
integer width = 576
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "품목이관오류삭제"
end type

event clicked;setpointer(hourglass!)

long ll_row, ll_rcnt
STRING ls_vsrno, ls_itno, ls_vndr

uo_status.st_message.text = '확인중..'
for ll_row = 1 to idw_42.rowcount()
	ls_vndr  = trim(idw_42.object.vndr[ll_row])
	ls_itno  = trim(idw_42.object.itno[ll_row])
	ls_vsrno = trim(idw_42.object.vsrno[ll_row])
	ll_rcnt = 0
	select count(*) 
	into :ll_rcnt
	from pbpur.pur103
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  itno  = :ls_itno;
	if ll_rcnt = 0 then
		messagebox('확인','행:' + string(ll_row) + ' 이관할(from) 품목단가 없음')
		return
	end if
	ll_rcnt = 0
	select count(*) 
	into :ll_rcnt
	from pbpur.pur105
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  itno  = :ls_itno;
	if ll_rcnt > 0 then
		messagebox('확인','행:' + string(ll_row) + ' 이관할(from) 품목 장기단가임')
		return
	end if
	
	ls_vsrno = ''
	select vsrno 
	into :ls_vsrno
	from pbpur.pur101
	where comltd = '01'
	and  vndr = :ls_vndr
	;
	if trim(ls_vsrno) = '' then
		messagebox('확인','행:' + string(ll_row) + ' 이관될(to)업체 사업자번호확인')
		return
	end if
	ll_rcnt = 0
	select count(*) 
	into :ll_rcnt
	from pbpur.pur103 a, pbpur.pur104 b
	where a.comltd = b.comltd
	and  a.vsrc = b.vsrc
	and  a.dept = b.dept
	and  a.vsrno = b.vsrno
	and  a.itno = b.itno
	and  a.dadjdt = b.adjdt
	and  a.comltd = '01'
	and  a.vsrno = :ls_vsrno
	and  a.itno  = :ls_itno;
	if ll_rcnt > 0 then
		messagebox('확인','행:' + string(ll_row) + ' 이관할(to) 품목단가 존재함')
		return
	end if
	
	
next
uo_status.st_message.text = '확정중..'

ll_rcnt = idw_42.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF


for ll_row = 1 to idw_42.rowcount()
	ls_vndr = trim(idw_42.object.vndr[ll_row])
	ls_itno = trim(idw_42.object.itno[ll_row])
	ls_vsrno = trim(idw_42.object.vsrno[ll_row])
	ll_rcnt = 0
	update pbpur.pur103
	set  xstop = 'O'
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  itno  = :ls_itno;
	
	ls_vsrno = ''
	select vsrno 
	into :ls_vsrno
	from pbpur.pur101
	where comltd = '01'
	and  vndr = :ls_vndr
	;
	delete from pbpur.pur103 
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  itno  = :ls_itno;
	delete from pbpur.pur104 
	where comltd = '01'
	and  vsrno = :ls_vsrno
	and  itno  = :ls_itno;
	
next
uo_status.st_message.text = '작업완료'

SETpointer(arrow!)
end event

type dw_42 from datawindow within tabpage_4
integer x = 2181
integer y = 148
integer width = 2254
integer height = 2092
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_42"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;idw_42 = this
this.settransobject(sqlca)
end event

type cb_9 from commandbutton within tabpage_4
integer x = 50
integer y = 24
integer width = 457
integer height = 92
integer taborder = 110
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "사유코드수정"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_vsrno, ls_itno, ls_adjdt,ls_xcause1
dec {2} ld_dcost,ld_xcost

ll_rcnt = idw_41.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF
SETpointer(hourglass!)
for ll_row = 1 to idw_41.rowcount()
	ls_vsrno   = idw_41.object.vsrno[ll_row]
	ls_itno    = idw_41.object.itno[ll_row]
	ls_adjdt   = idw_41.object.adjdt[ll_row]
	ls_xcause1 = idw_41.object.xcause1[ll_row]
	
	UPDATE "PBPUR"."PUR104"  
   SET "XCAUSE1" = :ls_xcause1  
   WHERE ( "PBPUR"."PUR104"."COMLTD" = '01' ) AND  
         ( "PBPUR"."PUR104"."VSRC" = 'D' ) AND  
         ( "PBPUR"."PUR104"."DEPT" = 'D' ) AND  
         ( "PBPUR"."PUR104"."VSRNO" = :ls_vsrno ) AND  
         ( "PBPUR"."PUR104"."ITNO" = :ls_itno ) AND  
         ( "PBPUR"."PUR104"."ADJDT" = :ls_adjdt )   
           ;
	
//	UPDATE "PBPUR"."PUR103"  
//   SET "DADJDT" = :ls_chgdt  
//   WHERE ( "PBPUR"."PUR103"."COMLTD" = '01' ) AND  
//         ( "PBPUR"."PUR103"."VSRC" = 'D' ) AND  
//         ( "PBPUR"."PUR103"."DEPT" = 'D' ) AND  
//         ( "PBPUR"."PUR103"."VSRNO" = :ls_vsrno ) AND  
//         ( "PBPUR"."PUR103"."ITNO" = :ls_itno )   
//           ;
		  
		
next
uo_status.st_message.text = '작업완료'
end event

type dw_41 from datawindow within tabpage_4
integer x = 23
integer y = 136
integer width = 1070
integer height = 1220
integer taborder = 70
string title = "none"
string dataobject = "d_pur299u_41"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event clicked;//This.SelectRow(0,False)
//This.SelectRow(row,True)
f_pur040_mselect(this, row)
//자료없는 부분 클릭시 선택 해제
IF dwo.name = "datawindow" Then
	This.SelectRow(0,false)
End IF
this.SetRedraw(False)
IF row < 1 THEN
   IF f_pur040_getobjph(this,is_colnm) = 1 THEN
		this.setsort(is_colnm)
      this.sort()
   END IF
END IF
this.SetRedraw(True)
end event

event constructor;this.settransobject(sqlca)
idw_41 = this
end event

type tabpage_5 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "외자관리용"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
dw_51 dw_51
cb_21 cb_21
cb_11 cb_11
ole_1 ole_1
cb_10 cb_10
end type

on tabpage_5.create
this.dw_51=create dw_51
this.cb_21=create cb_21
this.cb_11=create cb_11
this.ole_1=create ole_1
this.cb_10=create cb_10
this.Control[]={this.dw_51,&
this.cb_21,&
this.cb_11,&
this.ole_1,&
this.cb_10}
end on

on tabpage_5.destroy
destroy(this.dw_51)
destroy(this.cb_21)
destroy(this.cb_11)
destroy(this.ole_1)
destroy(this.cb_10)
end on

type dw_51 from datawindow within tabpage_5
integer x = 677
integer y = 768
integer width = 1760
integer height = 400
integer taborder = 100
string title = "none"
string dataobject = "d_pur299u_51"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;idw_51 = this
this.settransobject(sqlca)
end event

type cb_21 from commandbutton within tabpage_5
integer x = 41
integer y = 764
integer width = 594
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "위약수입면장막기"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_ipdt, ls_ipno, ls_itno

idw_51.reset()
f_pur040_getexcel(idw_51)
ll_rcnt = idw_51.rowcount()

ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
		IF ll_row <> 1 THEN
		  // Process CANCEL.
			// rollback using sqlca;
			 uo_status.st_message.text = '작업취소'
			 return
		END IF
SETpointer(hourglass!)
for ll_row  = 1 to idw_51.rowcount()
	ls_ipdt    = trim(idw_51.object.ipdt[ll_row])
	ls_ipno    = trim(idw_51.object.ipno[ll_row])
	ls_itno    = trim(idw_51.object.itno[ll_row])
	
	select count(*) into :ll_rcnt
	from pbrcd.rcd303
	where  comltd = '01'
	and    ipdt = :ls_ipdt
	and    ipno = :ls_ipno;
	//and    itno = :ls_itno;
	//if ll_rcnt <> 1 then
		messagebox('확인',string(ll_rcnt) + ':' + ls_ipdt + ':' + ls_ipno + ':' + ls_itno + ' 면장없음')
		//return
	//end if
next

for ll_row  = 1 to idw_51.rowcount()
	ls_ipdt    = trim(idw_51.object.ipdt[ll_row])
	ls_ipno    = trim(idw_51.object.ipno[ll_row])
	ls_itno    = trim(idw_51.object.itno[ll_row])
	update pbrcd.rcd303
	set  stcd = 'F', extd = 'F-UPDADD'
	where  comltd = '01'
	and    ipdt = :ls_ipdt
	and    ipno = :ls_ipno
	and    stcd = '';
	//and    itno = :ls_itno;
	
next

uo_status.st_message.text = '작업완료'
end event

type cb_11 from commandbutton within tabpage_5
integer x = 50
integer y = 48
integer width = 512
integer height = 92
integer taborder = 70
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "환급예상액생성"
end type

event clicked;uo_status.st_message.text = ''
setpointer(hourglass!)
string ls_epdt,ls_epno,ls_itno1,ls_itno2
dec ld_cost, ld_amt,ld_epqt
long ll_row

DECLARE cur_1 CURSOR FOR
   SELECT "PBRCD"."RCD402"."EPDT",   
         "PBRCD"."RCD402"."EPNO",   
         "PBRCD"."RCD402"."ITNO1",  
         "PBRCD"."RCD402"."ITNO2",  
			"PBRCD"."RCD402"."EPQT"  
    FROM "PBRCD"."RCD402"  
   WHERE ( "PBRCD"."RCD402"."COMLTD" = '01' ) AND  
         ( "PBRCD"."RCD402"."EPDT" > '20020101' ) AND  
         ( "PBRCD"."RCD402"."EAMT" = 0 )   ;

 OPEN cur_1;
 DO WHILE TRUE
	FETCH cur_1 INTO :ls_epdt,   
						  :ls_epno,   
						  :ls_itno1,
						  :ls_itno2,
						  :ld_epqt;
	if sqlca.sqlcode <> 0 then
		exit
	end if
	ll_row = ll_row + 1
	if mid(ls_epno,1,1) = 'D' or mid(ls_epno,1,1) > '0' then 
		ld_cost = 0
		SELECT coalesce("PBRCD"."RCD101"."DCOST"  ,0)
		INTO :ld_cost  
		FROM "PBRCD"."RCD101"  
		WHERE ( "PBRCD"."RCD101"."COMLTD" = '01' ) AND  
				  ( "PBRCD"."RCD101"."ITNO2" = :ls_itno2)   
				  ;
		ld_amt = ld_epqt * ld_cost	
		UPDATE "PBRCD"."RCD402"  
		SET "EAMT" = :ld_amt  
		WHERE ( "PBRCD"."RCD402"."COMLTD" = '01' ) AND  
				( "PBRCD"."RCD402"."EPDT" = :ls_epdt ) AND  
				( "PBRCD"."RCD402"."EPNO" = :ls_epno ) AND  
				( "PBRCD"."RCD402"."ITNO1" = :ls_itno1 )   
				  ;

	else  //라인
      ld_cost = 0
		SELECT coalesce("PBRCD"."RCD101"."LCOST"  ,0)
		INTO :ld_cost  
		FROM "PBRCD"."RCD101"  
		WHERE ( "PBRCD"."RCD101"."COMLTD" = '01' ) AND  
				  ( "PBRCD"."RCD101"."ITNO2" = :ls_itno2)   
				  ;
		ld_amt = ld_epqt * ld_cost	
		UPDATE "PBRCD"."RCD402"  
		SET "EAMT" = :ld_amt  
		WHERE ( "PBRCD"."RCD402"."COMLTD" = '01' ) AND  
				( "PBRCD"."RCD402"."EPDT" = :ls_epdt ) AND  
				( "PBRCD"."RCD402"."EPNO" = :ls_epno ) AND  
				( "PBRCD"."RCD402"."ITNO1" = :ls_itno1 )   
				  ;
	end if
	uo_status.st_message.text = string(ll_row) + '개 처리중'
 LOOP
 CLOSE cur_1;
uo_status.st_message.text = '작업완료'

end event

type ole_1 from olecontrol within tabpage_5
integer x = 1522
integer y = 40
integer width = 411
integer height = 284
integer taborder = 80
borderstyle borderstyle = stylelowered!
boolean focusrectangle = false
string binarykey = "w_pur299u.win"
omactivation activation = activateondoubleclick!
omdisplaytype displaytype = displayascontent!
omcontentsallowed contentsallowed = containsany!
end type

type cb_10 from commandbutton within tabpage_5
integer x = 50
integer y = 180
integer width = 1408
integer height = 92
integer taborder = 70
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "재구축용DATA MIGRATION(rcd603~~608)"
end type

event clicked;setpointer(hourglass!)
string ls_lib, ls_pgm
ls_lib = 'PBRCD'
ls_pgm = 'CRCDRTAR'
	Declare P_1 Procedure for pbpur.p_pur004 :ls_lib, :ls_pgm using sqlca;
	Execute P_1;
	if sqlca.sqlcode = -1 then
		uo_status.st_message.text = ' '
		messagebox('확인','(CRCDRTAR)중 오류발생, 연락바랍니다!',Exclamation!)
		return
	end if
//RCD603직수출갑
insert into pbrcd.rcd603
select '20030705',a.*,' ',' ',' ',' ',' ',' ', ' '
from pbrcd.rcdt02 a ;
uo_status.st_message.text = 'RCD603 작업완료'

//RCD604직수출을
insert into pbrcd.rcd604
select '20030705',a.ibsrno,
a.ibseq,a.ibepno,dec(a.ibebno),a.ibepdt,a.ibeqty,
a.ibunit,a.ibpfob,
' ',' ',' ',' ',' ',' ', ' '
from pbrcd.rcdt03 a ;
//  SELECT "PBRCD"."RCD604"."RFDT",   
//         "PBRCD"."RCD604"."SRNO",   
//         "PBRCD"."RCD604"."BSEQ",   
//         "PBRCD"."RCD604"."EPNO",   
//         "PBRCD"."RCD604"."EBNO",   
//         "PBRCD"."RCD604"."EPDT",   
//         "PBRCD"."RCD604"."EQTY",   
//         "PBRCD"."RCD604"."XUNIT",   
//         "PBRCD"."RCD604"."PFOB",   
//         "PBRCD"."RCD604"."EXTD",   
//         "PBRCD"."RCD604"."INPTID",   
//         "PBRCD"."RCD604"."INPTDT",   
//         "PBRCD"."RCD604"."UPDTID",   
//         "PBRCD"."RCD604"."UPDTDT",   
//         "PBRCD"."RCD604"."IPADDR",   
//         "PBRCD"."RCD604"."MACADDR"  
//    FROM "PBRCD"."RCD604"  ;


uo_status.st_message.text = 'RCD604 작업완료'

//RCD605직수출병
insert into pbrcd.rcd605
select '20030705',
 a."ICSRNO",   
	a."ICSEQ",   
	a."ICIMHS",   
	a."ICIPNO",   
	dec(a."ICIBNO"),
	a."ICTYPE",   
	a."ICSEMT",   
	a."ICIPDT",   
	a."ICSERT",   
	a."ICUNIT1",   
	a."ICRQTY",   
	a."ICUNIT2",   
	a."ICRMQT",   
	a."ICBOXN",   
	a."ICSECNT",   
	a."ICUCIF",   
	a."ICUCUR",   
	a."ICRTAX",   
	a."ICRCUR",   
	a."ICRTAR",   
	a."ICRDMT",   
	a."ICRDMD",   
	a."ICRDFT",   
	a."ICRTOT",  
   ' ',' ',' ',' ',' ',' ', ' '
from pbrcd.rcdt04 a ;
uo_status.st_message.text = 'RCD605 작업완료'

//return

//RCD606기납증갑
insert into pbrcd.rcd606
select '20030728',a.*,' ',' ',' ',' ',' ',' ', ' '
from pbrcd.rcdt05 a ;
uo_status.st_message.text = '기납증갑 RCD606 작업완료'

//RCD607기납증을
insert into pbrcd.rcd607
//select '20030630',a.*,' ',' ',' ',' ',' ',' ', ' '
//from pbrcd.rcdt06 a ;
SELECT  '20030728',
        a."IBSRNO",   
         a."IBSEQ",   
         a."IBPRNO",   
         a."IBPRNM",   
         a."IBPFOB",   
         a."IBEQTY",   
         a."IBRTAR",   
         a."IBRDMT",   
         a."IBRDMD",   
         a."IBRDFT",   
         a."IBRTOT",   
     (CASE WHEN a.ibdvsn in ('B','L','T') then 'J' //BETWEEN  0 AND  7 THEN 'WEEK1' 
           WHEN a.ibdvsn in ('P','N','O') then 'K'
	        //WHEN a.ibdvsn = 'Y' then 'Y'
	        ELSE 'D' end),
	  
	  (CASE WHEN a.ibdvsn in ('B','M','P') then 'M' //BETWEEN  0 AND  7 THEN 'WEEK1' 
           WHEN a.ibdvsn in ('L','S','N') then 'S'
			  WHEN a.ibdvsn in ('T','H','O') then 'H'
	        WHEN a.ibdvsn in ('E','C','W','Y') then 'A'
			  ELSE a.ibdvsn end),
	        ' ',' ',' ',' ',' ', ' ', ' ' 
    FROM pbrcd.rcdt06  a;

uo_status.st_message.text = '기납증을 RCD607 작업완료'

//RCD608기납증병
insert into pbrcd.rcd608
select '20030728',
b."ICSRNO",   
         b."ICSEQ",   
         b."ICIMHS",   
         b."ICIPNO",   
         dec(b."ICIBNO"),   
         b."ICTYPE",   
         b."ICSEMT",   
         b."ICIPDT",   
         b."ICSERT",   
         b."ICUNIT1",   
         b."ICRQTY",   
         b."ICUNIT2",   
         b."ICRMQT",   
         b."ICBOXN",   
         b."ICSECNT",   
         b."ICUCIF",   
         b."ICUCUR",   
         b."ICRTAX",   
         b."ICRCUR",   
         b."ICRTAR",   
         b."ICRDMT",   
         b."ICRDMD",   
         b."ICRDFT",   
         b."ICRTOT"  ,
' ',' ',' ',' ',' ',' ', ' '
from pbrcd.rcdt07 b ;
uo_status.st_message.text = '기납증병 RCD608 작업완료'







end event

type tabpage_6 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "감사용구매실적(2003.10)"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
dw_4 dw_4
end type

on tabpage_6.create
this.dw_4=create dw_4
this.Control[]={this.dw_4}
end on

on tabpage_6.destroy
destroy(this.dw_4)
end on

type dw_4 from datawindow within tabpage_6
integer x = 23
integer y = 24
integer width = 3931
integer height = 2288
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_61"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_61 = this
end event

type tabpage_7 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "중단품목"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
dw_5 dw_5
end type

on tabpage_7.create
this.dw_5=create dw_5
this.Control[]={this.dw_5}
end on

on tabpage_7.destroy
destroy(this.dw_5)
end on

type dw_5 from datawindow within tabpage_7
integer x = 18
integer y = 16
integer width = 3963
integer height = 2292
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_71"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_71 = this
end event

type tabpage_8 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "외자구매용"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_16 cb_16
dw_81 dw_81
end type

on tabpage_8.create
this.cb_16=create cb_16
this.dw_81=create dw_81
this.Control[]={this.cb_16,&
this.dw_81}
end on

on tabpage_8.destroy
destroy(this.cb_16)
destroy(this.dw_81)
end on

type cb_16 from commandbutton within tabpage_8
integer x = 1527
integer y = 60
integer width = 457
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "조회"
end type

event clicked;setpointer(hourglass!)
idw_81.reset()
uo_status.st_message.text = '조회중'
idw_81.retrieve() 

uo_status.st_message.text = '조회완료'
setpointer(arrow!)
end event

type dw_81 from datawindow within tabpage_8
integer x = 165
integer y = 32
integer width = 1230
integer height = 784
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_81"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_81 = this
end event

type tabpage_9 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "품질지수체크"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_17 cb_17
dw_92 dw_92
cb_91 cb_91
dw_91 dw_91
end type

on tabpage_9.create
this.cb_17=create cb_17
this.dw_92=create dw_92
this.cb_91=create cb_91
this.dw_91=create dw_91
this.Control[]={this.cb_17,&
this.dw_92,&
this.cb_91,&
this.dw_91}
end on

on tabpage_9.destroy
destroy(this.cb_17)
destroy(this.dw_92)
destroy(this.cb_91)
destroy(this.dw_91)
end on

type cb_17 from commandbutton within tabpage_9
integer x = 3369
integer y = 24
integer width = 457
integer height = 92
integer taborder = 80
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "조회및수정"
end type

event clicked;string ls_div,ls_itno1, ls_itno2

long   ll_row, ll_rcnt


uo_status.st_message.text = ''
setpointer(hourglass!)
if idw_92.rowcount() = 0 then
	f_pur040_getexcel(idw_92)
  ll_row = idw_92.rowcount()
  if ll_row > 0 then
		wf_icon_onoff(true,false,true,false,false,true,false,true,false)	
	else
		wf_icon_onoff(true,false,false,false,false,false,false,true,false)	
	end if
	uo_status.st_message.text = 'UPLOAD성공' + 'Count:' + string(ll_row) 
	return
end if
for ll_row = 1 to idw_92.rowcount()
	ls_div = trim(idw_92.object.divcd[ll_row])
	ls_itno1 = trim(idw_92.object.itno1[ll_row])
	ls_itno2 = trim(idw_92.object.itno2[ll_row])
	UPDATE "PBPUR"."PRR001"  
   SET "ITNO" = :ls_itno2  
	WHERE ( "PBPUR"."PRR001"."DIVCD" = :ls_div ) AND  
			( "PBPUR"."PRR001"."ITNO" = :ls_itno1 )   
				  ;
   if sqlca.sqlcode <> 0 then
		messagebox('확인','SQLCODE <> 0' + ' itno1 =' + ls_itno1)
	end if
	uo_status.st_message.text = string(ll_row)+ '/' + string(idw_92.rowcount()) + '개 처리중'
next

 
uo_status.st_message.text = '작업완료'



end event

type dw_92 from datawindow within tabpage_9
integer x = 2478
integer y = 148
integer width = 1426
integer height = 2152
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_92"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_92 = this
end event

type cb_91 from commandbutton within tabpage_9
integer x = 1742
integer y = 32
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "품목조회"
end type

event clicked;string ls_xplant, ls_div, ls_costdiv, ls_itno, ls_itnm, ls_vsrno
string ls_md, ls_wrtdate, ls_wrtname, ls_title, ls_prrsts, ls_prrid,ls_xstop
long   ll_row, ll_rcnt
dec    ld_qty

uo_status.st_message.text = ''
setpointer(hourglass!)
idw_91.reset()

DECLARE cur_1 CURSOR FOR
     SELECT "PBPUR"."PRR001"."DIVCD",   
         "PBPUR"."PRR001"."ITNO",   
         "PBPUR"."PRR001"."ITNM",   
         "PBPUR"."PRR001"."VSRNO",   
         "PBPUR"."PRR001"."MD",   
         "PBPUR"."PRR001"."WRT_DATE",   
         "PBPUR"."PRR001"."WRT_NAME",   
         "PBPUR"."PRR001"."TITLE",   
         "PBPUR"."PRR001"."PRRSTS",   
         "PBPUR"."PRR001"."PRRID"  
   FROM "PBPUR"."PRR001"  
   WHERE ( "PBPUR"."PRR001"."WRT_DATE" >= '20040101' ) AND  
         ( "PBPUR"."PRR001"."WRT_DATE" <= '20040531' )   
	order by 6		;

 OPEN cur_1;
 DO WHILE TRUE
	FETCH cur_1 INTO :ls_costdiv, :ls_itno, :ls_itnm, :ls_vsrno,   
						  :ls_md,  :ls_wrtdate,   :ls_wrtname, :ls_title,   
						  :ls_prrsts,  :ls_prrid;
	if sqlca.sqlcode <> 0 then
		exit
	end if
	ll_row = ll_row + 1
//	Choose case ls_costdiv
//		case 'B'
//			ls_xplant = 'J'
//			ls_div = 'M'
//		case 'L'
//			ls_xplant = 'J'
//			ls_div = 'S'
//		case 'T'
//			ls_xplant = 'J'
//			ls_div = 'H'	
//		case 'P'
//			ls_xplant = 'K'
//			ls_div = 'M'
//		case 'N'
//			ls_xplant = 'K'
//			ls_div = 'S'
//		case 'O'
//			ls_xplant = 'K'
//			ls_div = 'H'
//		case 'M','S','H','A','V'
//			ls_xplant = 'D'
//			ls_div = ls_costdiv		
//		case 'Y'
//			ls_xplant = 'Y'
//			ls_div = 'Y'
//		case else
//			ls_xplant = ''
//			ls_div = ''
//	End choose
	ll_rcnt = 0
//BALANCE유무	
//	select count(*)
//	into  :ll_rcnt
//	from pbinv.inv101
//	where comltd = '01'
//	and   xplant = :ls_xplant
//	and   div    = :ls_div
//	and   itno   = :ls_itno  ;
//업체품목단가조회	
   ls_xstop = 'A'
	select xstop
	into  :ls_xstop
	from pbpur.pur103
	where comltd = '01'
	and   dept   = 'D'
	and   itno   = :ls_itno
	and   vsrno  = :ls_vsrno;
	if ls_xstop = 'A' or isnull(ls_xstop) then
		ll_rcnt = idw_91.insertrow(0)
		idw_91.object.gubun[ll_rcnt] = '품목단가없음'
		idw_91.object.divcd[ll_rcnt] = ls_costdiv
		idw_91.object.itno[ll_rcnt]  = ls_itno
		idw_91.object.itnm[ll_rcnt]  = ls_itnm
		idw_91.object.vsrno[ll_rcnt] = ls_vsrno
		idw_91.object.md[ll_rcnt]    = ls_md
		idw_91.object.wrt_date[ll_rcnt] = ls_wrtdate
		idw_91.object.wrt_name[ll_rcnt] = ls_wrtname
		idw_91.object.prrid[ll_rcnt] = ls_prrid
		idw_91.object.prrsts[ll_rcnt] = ls_prrsts
		idw_91.object.title[ll_rcnt] = ls_title
		continue
	
    elseif ls_xstop = 'X' then
		ll_rcnt = idw_91.insertrow(0)
		idw_91.object.gubun[ll_rcnt] = '업체단가중단품목'
		idw_91.object.divcd[ll_rcnt] = ls_costdiv
		idw_91.object.itno[ll_rcnt]  = ls_itno
		idw_91.object.itnm[ll_rcnt]  = ls_itnm
		idw_91.object.vsrno[ll_rcnt] = ls_vsrno
		idw_91.object.md[ll_rcnt]    = ls_md
		idw_91.object.wrt_date[ll_rcnt] = ls_wrtdate
		idw_91.object.wrt_name[ll_rcnt] = ls_wrtname
		idw_91.object.prrid[ll_rcnt] = ls_prrid
		idw_91.object.prrsts[ll_rcnt] = ls_prrsts
		idw_91.object.title[ll_rcnt] = ls_title
		continue
	end if
//입고실적체크	
   ld_qty = 0
	select coalesce(sum(rpqty - ssqty),0)
	into  :ld_qty
	from pbinv.inv203
	where comltd = '01'
	and   itno   = :ls_itno
	and   vsrno  = :ls_vsrno
	and   xyear  = '2004'
	and   mm = ' '
	  ;
   if ld_qty <= 0 then
		ll_rcnt = idw_91.insertrow(0)
		idw_91.object.gubun[ll_rcnt] = '4개월입고실적없음'
		idw_91.object.divcd[ll_rcnt] = ls_costdiv
		idw_91.object.itno[ll_rcnt]  = ls_itno
		idw_91.object.itnm[ll_rcnt]  = ls_itnm
		idw_91.object.vsrno[ll_rcnt] = ls_vsrno
		idw_91.object.md[ll_rcnt]    = ls_md
		idw_91.object.wrt_date[ll_rcnt] = ls_wrtdate
		idw_91.object.wrt_name[ll_rcnt] = ls_wrtname
		idw_91.object.prrid[ll_rcnt] = ls_prrid
		idw_91.object.prrsts[ll_rcnt] = ls_prrsts
		idw_91.object.title[ll_rcnt] = ls_title
	end if
	
	uo_status.st_message.text = string(ll_row) + '개 처리중'
 LOOP
 CLOSE cur_1;
uo_status.st_message.text = '작업완료'



end event

type dw_91 from datawindow within tabpage_9
integer x = 27
integer y = 148
integer width = 2395
integer height = 2176
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_91"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_91 = this
end event

type tabpage_10 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "트랜스금액수정"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
cb_24 cb_24
dw_101 dw_101
end type

on tabpage_10.create
this.cb_24=create cb_24
this.dw_101=create dw_101
this.Control[]={this.cb_24,&
this.dw_101}
end on

on tabpage_10.destroy
destroy(this.cb_24)
destroy(this.dw_101)
end on

type cb_24 from commandbutton within tabpage_10
integer x = 3410
integer y = 76
integer width = 457
integer height = 92
integer taborder = 90
integer textsize = -10
integer weight = 400
fontcharset fontcharset = hangeul!
fontpitch fontpitch = fixed!
fontfamily fontfamily = modern!
string facename = "굴림체"
string text = "수정"
end type

event clicked;long ll_row, ll_rcnt
STRING ls_sliptype, ls_srno, ls_srno1, ls_srno2 
dec {2} ld_costav,ld_xcost

ll_rcnt = idw_101.rowcount()
ll_row = MessageBox("확인", '품목: ' + string(ll_rcnt) +   '개가 수정됩니다. 확인키를 누르세요!', &
		Exclamation!, OKCancel!, 2)
IF ll_row <> 1 THEN
  // Process CANCEL.
	// rollback using sqlca;
	 uo_status.st_message.text = '작업취소'
	 return
END IF
SETpointer(hourglass!)

for ll_row = 1 to idw_101.rowcount()
	ls_sliptype  = idw_101.object.sliptype[ll_row]
	ls_srno      = idw_101.object.srno[ll_row]
	ls_srno1     = idw_101.object.srno1[ll_row]
	ls_srno2     = idw_101.object.srno2[ll_row]
	ld_costav    = idw_101.object.costav[ll_row]
		
	UPDATE pbinv.inv401
   SET xcost = :ld_costav, tramt = truncate(tqty4 * :ld_costav,0)
	    //updtid = '999999'
   WHERE comltd = '01'  
    and  sliptype = :ls_sliptype  
	 and  srno  = :ls_srno
	 and  srno1 = :ls_srno1
	 and  srno2 = :ls_srno2
           ;
    if sqlca.sqlcode <> 0 then
		 messagebox('확인','행:' + string(ll_row) + ' 업데이트에러',Exclamation!)
	 end if
		  
	uo_status.st_message.text = string(ll_row) + '/' + string(idw_101.rowcount()) + ' 작업중...'	
next
uo_status.st_message.text = '작업완료'
SETpointer(arrow!)



end event

type dw_101 from datawindow within tabpage_10
integer x = 41
integer y = 72
integer width = 3314
integer height = 828
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_101"
boolean hscrollbar = true
boolean vscrollbar = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_101 = this
end event

type tabpage_11 from userobject within tab_1
integer x = 18
integer y = 184
integer width = 4517
integer height = 2248
long backcolor = 12632256
string text = "개인용도"
long tabtextcolor = 33554432
long tabbackcolor = 12632256
long picturemaskcolor = 536870912
dw_111 dw_111
end type

on tabpage_11.create
this.dw_111=create dw_111
this.Control[]={this.dw_111}
end on

on tabpage_11.destroy
destroy(this.dw_111)
end on

type dw_111 from datawindow within tabpage_11
integer x = 27
integer y = 48
integer width = 2670
integer height = 1976
integer taborder = 80
string title = "none"
string dataobject = "d_pur299u_111"
boolean hscrollbar = true
boolean vscrollbar = true
boolean resizable = true
boolean hsplitscroll = true
boolean livescroll = true
borderstyle borderstyle = stylelowered!
end type

event constructor;this.settransobject(sqlca)
idw_111 = this
//품번,적용일까지 키
end event


Start of PowerBuilder Binary Data Section : Do NOT Edit
07w_pur299u.bin 1540 1148254285
2000000600e011cfd0e11ab1a1000000000000000000000000000000000003003e0009fffe00000006000000000000000000000001000000010000000000001000fffffffe00000000fffffffe0000000000000000fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffdfffffffeffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff006f00520074006f004500200074006e00790072000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000050016ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000fffffffe00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
17w_pur299u.bin 1540 1148254285
End of PowerBuilder Binary Data Section : No Source Expected After This Point
