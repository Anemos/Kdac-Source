
-- 재료비생성
SELECT TMP.COMLTD,TMP.AREV,TMP.ACODE,TMP.AYEAR,TMP.APLANT,TMP.ADIV,TMP.APDCD,TMP.AMDNO,TMP.SEQGB,TMP.ADECD,0,
-- 내자 금액계산 
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '10' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDWON,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '11' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDUSD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '12' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDJPY,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '13' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDDEM,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '14' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDFRF,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '15' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDGBP,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '16' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDAUD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '17' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDESP,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '18' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDEMU,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '19' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDITL,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '20' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDCHF,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '21' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDBFR,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '22' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDDKK,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '23' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDATS,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '24' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDCAD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '25' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDSEK,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '26' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDRMB,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE <> '01' AND TMP.CLS <> '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '99' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MDETC,
--외자재료비 계산
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '11' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIUSD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '12' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIJPY,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '13' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIDEM,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '14' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIFRF,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '15' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIGBP,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '16' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIAUD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '17' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIESP,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '18' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIEUR,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '19' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIITL,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '20' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MICHF,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '21' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIBFR,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '22' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIDKK,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '23' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIATS,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '24' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MICAD,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '25' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MISEK,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '26' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIRMB,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.SRCE = '01' THEN
			CASE WHEN TMP.CUR_SEQNO = '99' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MIETC,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.CLS = '40' THEN
			CASE WHEN TMP.CUR_SEQNO = '10' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MOMAT,
SUM( DECIMAL(CASE WHEN TMP.BWOCT <> '8888' AND TMP.BYOU <> '*' AND TMP.CLS = '50' THEN
			CASE WHEN TMP.CUR_SEQNO = '10' THEN 
				CASE WHEN TMP.ADECD = 'D' THEN TMP.CURDCST * TMP.WKEXCD / TMP.CONV_FACTOR * TMP.BPRQT
 				ELSE TMP.CURECST * TMP.WKEXCE / TMP.CONV_FACTOR * TMP.BPRQT END
			ELSE 0 END
		ELSE 0 END,15,6) ) AS MOLAT
FROM ( SELECT AA.COMLTD,AA.AREV,AA.ACODE,AA.AYEAR,AA.APLANT,AA.ADIV,
AA.APDCD,AA.AMDNO,AA.ADECD,AA.SEQGB,BB.BPLANT,BB.BDIV,
BB.BMDNO,BB.BSERNO,BB.BPRNO,BB.BCHNO,DD.CLS,
BB.BWOCT,BB.BYOU,BB.BPRQT,DD.SRCE,CC.YVNDSR,CC.YPLAN,
CC.YCURR,CC.YCSTD,CC.YCSTE,
-- 내자환율 적용
CC.YCURR AS CURD,
-- 외자환율 적용
CC.YCURR AS CURE,
-- 외자적용기준단가
CASE WHEN DD.CLS = '10' OR DD.CLS = '20' OR DD.CLS = '40' OR DD.CLS = '50' OR DD.CLS = '35' THEN
	CASE WHEN ( DD.SRCE = '03' OR DD.SRCE = '05' OR DD.SRCE = '06' ) OR DD.CLS = '30' THEN 0
   ELSE CASE WHEN DD.SRCE <> '01' THEN 
          CASE WHEN CC.YCSTE = 0 THEN CC.YCSTD ELSE CC.YCSTE END
        ELSE CC.YCSTE END 
   END
ELSE 0 END AS CURECST,
-- 내자적용기준단가
CASE WHEN DD.CLS = '10' OR DD.CLS = '20' OR DD.CLS = '40' OR DD.CLS = '50' OR DD.CLS = '35' THEN
	CASE WHEN ( DD.SRCE = '03' OR DD.SRCE = '05' OR DD.SRCE = '06' ) OR DD.CLS = '30' THEN 0
   ELSE CASE WHEN DD.SRCE <> '01' THEN 
          CASE WHEN CC.YCSTD = 0 THEN CC.YCSTE ELSE CC.YCSTD END
        ELSE CC.YCSTD END 
   END
ELSE 0 END AS CURDCST,
-- 변환계수
CC.CONVQTY AS CONV_FACTOR,
-- 통화번호
IFNULL(EE.SEQNO,'99') AS CUR_SEQNO,
-- 외자환율
CASE WHEN CC.YCURR <> '' AND CC.YCURR <> 'KRW' THEN
   ( SELECT EXCH FROM PBBPM.BPM506 WHERE XYEAR = '2009' AND CURR = CC.YCURR )
ELSE 1 END AS WKEXCE,
-- 내자환율
CASE WHEN CC.YCURR <> '' AND CC.YCURR <> 'KRW' THEN
   ( SELECT EXCH FROM PBBPM.BPM506 WHERE XYEAR = '2009' AND CURR = CC.YCURR )
ELSE 1 END AS WKEXCD
FROM ( SELECT DISTINCT COMLTD,AYEAR,AREV,ACODE,APLANT,ADIV,APDCD,AMDNO,'D' AS ADECD,SEQGB FROM PBBPM.BPM501
WHERE COMLTD = '01' AND AYEAR = '2009' AND AREV = '0A' AND APLANT = 'D' AND ADIV = 'A' AND ACODE = 'A' AND AMDNO = '13500186' ) AA
INNER JOIN PBBPM.BPM508 BB
ON AA.COMLTD = BB.COMLTD AND AA.APLANT = BB.BPLANT AND AA.ADIV = BB.BDIV AND
	AA.AMDNO = BB.BMDNO AND AA.AYEAR = BB.XYEAR AND AA.AREV = BB.BREV AND
	AA.ACODE = BB.BGUBUN
LEFT OUTER JOIN PBBPM.BPM503 DD
ON BB.XYEAR = DD.XYEAR AND BB.BPLANT = DD.XPLANT AND BB.BDIV = DD.DIV AND BB.BCHNO = DD.ITNO
LEFT OUTER JOIN PBBPM.BPM509 CC
ON BB.XYEAR = CC.YCCYY AND BB.BPLANT = CC.YPLANT AND 
   BB.BDIV = CC.YDIV AND BB.BCHNO = CC.YITNO AND
   CC.YGUBUN = '10' AND CC.YGRAD = '1'
LEFT OUTER JOIN PBBPM.BPM520 EE
ON CC.YCURR = EE.CURUNIT
ORDER BY AA.APLANT,AA.ADIV,AA.AMDNO,AA.ADECD,BB.BSERNO ) TMP
GROUP BY TMP.COMLTD,TMP.AREV,TMP.ACODE,TMP.AYEAR,TMP.APLANT,TMP.ADIV,
TMP.APDCD,TMP.AMDNO,TMP.SEQGB,TMP.ADECD
ORDER BY TMP.COMLTD,TMP.AREV,TMP.ACODE,TMP.AYEAR,TMP.APLANT,TMP.ADIV,
TMP.APDCD,TMP.AMDNO,TMP.SEQGB,TMP.ADECD;