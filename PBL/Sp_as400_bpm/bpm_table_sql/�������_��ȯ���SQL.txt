SELECT A.UITNO,A.UUNIT1,A.UUNIT2,A.UUMCV,B.BOMUNIT,B.XUNIT,B.XUNIT1,B.CONVQTY 
FROM PBBPM.BPM105 A INNER JOIN PBBPM.BPM509 B
	ON A.UITNO = B.YITNO AND B.YCCYY = '2099'
WHERE A.UYEAR = '2009' AND A.UUMCV <> B.CONVQTY;


   INSERT INTO PBBPM.BPM105  
( COMLTD,   UYEAR,   UPLANT,   UDIV,   UITNO,   UUNIT1,   UUNIT2,   UUMCV,   
UAREA,   EXTD,   INPTID,   INPTDT,   UPDTID,   UPDTDT,   IPADDR,   MACADDR )

SELECT DISTINCT A.COMLTD,'2009',A.UPLANT,A.UDIV,A.UITNO,B.BOMUNIT,B.XUNIT1,DECIMAL(TRUNCATE(B.CONVQTY,5) ,13,5) AS CONVQTY,
'','','','','','','',''
FROM PBBPM.BPM105BK A INNER JOIN PBBPM.BPM509 B
	ON A.UITNO = B.YITNO AND B.YCCYY = '2099' AND B.YGUBUN = '10' AND B.YGRAD = '1'
WHERE A.UYEAR = '2009' AND A.UUMCV = B.CONVQTY;

//DELETE FROM PBBPM.BPM105 WHERE UYEAR = '2009';

//SELECT * FROM PBBPM.BPM105 A
//WHERE A.UYEAR = '2009' AND NOT EXISTS ( SELECT * FROM PBBPM.BPM509 B
//	WHERE B.YCCYY = '2099' AND B.YGUBUN = '10' AND B.YGRAD = '1' AND A.UITNO = B.YITNO);


INSERT INTO PBBPM.BPM105  
( COMLTD,   UYEAR,   UPLANT,   UDIV,   UITNO,   UUNIT1,   UUNIT2,   UUMCV,   
UAREA,   EXTD,   INPTID,   INPTDT,   UPDTID,   UPDTDT,   IPADDR,   MACADDR )
SELECT DISTINCT A.COMLTD,'2009',A.UPLANT,A.UDIV,A.UITNO,B.BOMUNIT,B.XUNIT1,DECIMAL(TRUNCATE(B.CONVQTY,5) ,13,5) AS CONVQTY,
'','','','','','','',''
FROM PBBPM.BPM105BK A INNER JOIN ( SELECT DISTINCT D.YITNO,D.BOMUNIT,D.XUNIT1,D.CONVQTY FROM PBBPM.BPM509 D
	WHERE D.YCCYY = '2099' AND D.YGUBUN = '10' AND D.YGRAD = '1' AND
		NOT EXISTS ( SELECT * FROM PBBPM.BPM105 C WHERE C.UITNO = D.YITNO AND C.UYEAR = '2009' ) ) B
	ON A.UITNO = B.YITNO
WHERE A.UYEAR = '2009' AND A.UUMCV = B.CONVQTY;